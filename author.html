<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=1.0, user-scalable=no">
    <title id="pageTitle">I AM MUGERA | Author Library</title>
    <link rel="icon" type="image/x-icon" id="pageFavicon" href="https://i.postimg.cc/Kzsb3tX6/I-AM-MUGERA.png">
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Cinzel:wght@400;500;600;700;800&family=Lora:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-analytics.js"></script>
    
    <style>
        /* ---------- FULL THEME – EXACT MATCH YOUR BRAND ---------- */
        :root {
            --black: #0a0a0a;
            --white: #ffffff;
            --gray: #f9f9f9;
            --dark-gray: #1a1a1a;
            --light-gray: #e8e8e8;
            --gold: #ca8a04;
            --gold-light: #fef3c7;
            --gold-dark: #a16207;
            --african-brown: #8B4513;
            --african-red: #B22222;
            --african-earth: #D2691E;
            --african-pattern-bg: #f5f0e6;
            --success: #10b981;
            --error: #ef4444;
            --info: #3b82f6;
            --purple: #8b5cf6;
            --teal: #14b8a6;
            --pink: #ec4899;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0,0,0,0.25);
            --radius-xs: 4px;
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
            --radius-3xl: 28px;
            --radius-full: 9999px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; scroll-padding-top: 80px; font-size: 15px; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--white);
            color: var(--black);
            line-height: 1.6;
            overflow-x: hidden;
        }
        .cinzel-font { font-family: 'Cinzel', serif; font-weight: 600; letter-spacing: 0.5px; }
        .lora-font { font-family: 'Lora', serif; }
        .highlight { color: var(--gold); position: relative; display: inline-block; }
        .highlight::after { content: ''; position: absolute; bottom: 2px; left: 0; width: 100%; height: 6px; background-color: var(--gold); opacity: 0.2; z-index: -1; border-radius: var(--radius-xs); }

        /* ---------- LOADING OVERLAY – QUOTE ANIMATION ---------- */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a1a 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }
        .loading-spinner {
            width: 70px;
            height: 70px;
            border: 3px solid rgba(202, 138, 4, 0.1);
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            animation: spin 1.2s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
            margin-bottom: 2rem;
            box-shadow: 0 0 30px rgba(202,138,4,0.3);
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .quote-container { text-align: center; max-width: 800px; margin: 0 auto; padding: 2rem; }
        .quote-icon { font-size: 3rem; color: var(--gold); margin-bottom: 1rem; opacity: 0.7; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100% { opacity:0.5; transform:scale(1); } 50% { opacity:1; transform:scale(1.1); } }
        .quote-text { font-family: 'Cinzel', serif; font-size: 2.2rem; line-height: 1.4; color: var(--white); margin-bottom: 1.5rem; min-height: 140px; }
        .typing-container { display: inline-block; text-align: left; }
        .cursor { display: inline-block; width: 3px; height: 2.2rem; background-color: var(--gold); margin-left: 4px; animation: blink 1s infinite; vertical-align: middle; }
        @keyframes blink { 0%,50% { opacity:1; } 51%,100% { opacity:0; } }

        /* ---------- HEADER – WITH USER AUTH ---------- */
        header {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            z-index: 1000;
            background: rgba(255,255,255,0.98);
            backdrop-filter: blur(20px);
            height: 80px;
            border-bottom: 4px solid transparent;
            background-image: linear-gradient(white,white), repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 5px, var(--gold-dark) 5px, var(--gold-dark) 10px, transparent 10px, transparent 15px);
            background-clip: padding-box, border-box;
            box-shadow: var(--shadow-sm);
        }
        .header-container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; display: flex; align-items: center; justify-content: space-between; height: 100%; }
        .brand-logo { height: 55px; width: auto; border-radius: var(--radius-sm); padding: 5px; background: linear-gradient(135deg, white, var(--gray)); border: 1px solid rgba(202,138,4,0.1); }
        .nav-container { display: flex; align-items: center; }
        .main-nav { display: flex; list-style: none; gap: 1.5rem; margin: 0; padding: 0; }
        .nav-link { text-decoration: none; color: var(--dark-gray); font-weight: 600; font-size: 0.9rem; padding: 0.5rem 0.75rem; display: flex; align-items: center; gap: 0.5rem; border-radius: var(--radius-md); transition: var(--transition); }
        .nav-link:hover { color: var(--gold); background: rgba(202,138,4,0.05); }
        .nav-link.active { color: var(--gold); background: rgba(202,138,4,0.08); }
        
        /* User Menu */
        .user-menu {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-left: 2rem;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }
        .user-avatar:hover { transform: scale(1.05); box-shadow: 0 0 0 3px rgba(202,138,4,0.3); }
        .user-dropdown {
            position: absolute;
            top: 70px;
            right: 1.5rem;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-xl);
            width: 280px;
            padding: 1.5rem;
            border: 2px solid transparent;
            background-image: linear-gradient(white, white), repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 5px, var(--gold-dark) 5px, var(--gold-dark) 10px);
            background-clip: padding-box, border-box;
            display: none;
            z-index: 1001;
        }
        .user-dropdown.active { display: block; }
        .subscription-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: white;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        /* ---------- HERO SECTION ---------- */
        .hero {
            min-height: 70vh;
            display: flex;
            align-items: center;
            background: url('https://i.postimg.cc/fyxmyB9n/20260204-1035-Image-Generation-remix-01kgks60qgeata5pv0jy8vkg0d.png');
            background-size: 400px 400px;
            background-attachment: fixed;
            color: var(--white);
            padding: 6rem 1.5rem 3rem;
            position: relative;
        }
        .hero::before { content: ''; position: absolute; top:0; left:0; right:0; bottom:0; background: linear-gradient(135deg, rgba(0,0,0,0.85), rgba(0,0,0,0.72)); z-index:1; }
        .hero-content { max-width: 1000px; margin: 0 auto; position: relative; z-index: 3; }
        .hero-text-container { padding: 2.5rem; background: rgba(0,0,0,0.4); backdrop-filter: blur(20px); border-radius: var(--radius-xl); border: 1px solid rgba(202,138,4,0.2); }

        /* ---------- PUBLICATIONS LIBRARY – FULL GRID ---------- */
        .library-section {
            padding: 5rem 1.5rem;
            background: linear-gradient(135deg, var(--african-pattern-bg) 0%, var(--white) 100%);
        }
        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 3rem;
        }
        .library-filters {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 0.5rem 1.25rem;
            border: 2px solid rgba(202,138,4,0.3);
            background: transparent;
            border-radius: var(--radius-full);
            font-weight: 600;
            color: var(--dark-gray);
            cursor: pointer;
            transition: var(--transition);
        }
        .filter-btn.active, .filter-btn:hover {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
        }
        .publications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 2.5rem;
            margin-top: 2rem;
        }
        .publication-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 3px solid transparent;
            background: linear-gradient(var(--white), var(--white)) padding-box,
                        repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 8px, var(--gold-dark) 8px, var(--gold-dark) 16px) border-box;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .publication-card:hover { transform: translateY(-8px); box-shadow: var(--shadow-xl); }
        .publication-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.4rem 1.2rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge-premium { background: linear-gradient(135deg, #ec4899, #b91c1c); color: white; }
        .badge-free { background: linear-gradient(135deg, #10b981, #047857); color: white; }
        .badge-serialized { background: linear-gradient(135deg, #8b5cf6, #6d28d9); color: white; }
        .badge-coming-soon { background: linear-gradient(135deg, #f59e0b, #b45309); color: white; }
        
        .publication-type {
            display: inline-block;
            padding: 0.3rem 1rem;
            background: rgba(202,138,4,0.1);
            color: var(--gold-dark);
            border-radius: var(--radius-full);
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 1rem;
            align-self: flex-start;
        }
        .publication-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--black);
            font-family: 'Cinzel', serif;
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }
        .publication-subtitle {
            font-size: 0.95rem;
            color: var(--gold-dark);
            font-style: italic;
            margin-bottom: 1rem;
        }
        .publication-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.2rem;
            margin: 1rem 0;
            color: var(--dark-gray);
            font-size: 0.9rem;
        }
        .publication-meta i { color: var(--gold); width: 18px; }
        .publication-description {
            color: var(--dark-gray);
            line-height: 1.7;
            margin-bottom: 1.5rem;
            flex: 1;
        }
        .publication-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 1.25rem;
            border-top: 1px solid var(--light-gray);
        }
        .reading-time {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: var(--dark-gray);
            font-size: 0.85rem;
        }
        .btn-publication {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .btn-publication.premium { background: linear-gradient(135deg, #ec4899, #b91c1c); color: white; }
        .btn-publication.free { background: var(--gold); color: white; }
        .btn-publication.waitlist { background: var(--dark-gray); color: white; }
        .btn-publication:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

        /* ---------- SERIES & COLLECTIONS ---------- */
        .series-section {
            padding: 4rem 1.5rem;
            background: linear-gradient(135deg, #111827, #1e293b);
            color: white;
        }
        .series-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .series-card {
            background: rgba(255,255,255,0.08);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 2rem;
            border: 1px solid rgba(202,138,4,0.3);
            transition: var(--transition);
        }
        .series-card:hover { border-color: var(--gold); transform: translateY(-5px); }
        .series-name { font-size: 1.4rem; font-family: 'Cinzel', serif; color: var(--gold); margin-bottom: 0.75rem; }
        .series-work-count { display: inline-block; padding: 0.2rem 0.8rem; background: rgba(202,138,4,0.2); border-radius: var(--radius-full); font-size: 0.8rem; }

        /* ---------- SUBSCRIPTION TIERS SECTION ---------- */
        .subscription-section {
            padding: 5rem 1.5rem;
            background: linear-gradient(135deg, var(--african-pattern-bg), white);
        }
        .tiers-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            max-width: 1200px;
            margin: 3rem auto 0;
        }
        .tier-card {
            background: white;
            border-radius: var(--radius-xl);
            padding: 2.5rem 2rem;
            text-align: center;
            box-shadow: var(--shadow-lg);
            border: 3px solid transparent;
            background: linear-gradient(white, white) padding-box,
                        repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 8px, var(--gold-dark) 8px, var(--gold-dark) 16px) border-box;
            position: relative;
        }
        .tier-recommended {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: white;
            padding: 0.4rem 1.5rem;
            border-radius: var(--radius-full);
            font-weight: 700;
            font-size: 0.85rem;
            text-transform: uppercase;
        }
        .tier-name { font-size: 1.75rem; font-family: 'Cinzel', serif; color: var(--black); margin-bottom: 0.5rem; }
        .tier-price { font-size: 2.2rem; font-weight: 800; color: var(--gold-dark); margin: 1rem 0; }
        .tier-price span { font-size: 1rem; font-weight: 400; color: var(--dark-gray); }
        .tier-features { list-style: none; margin: 2rem 0; text-align: left; }
        .tier-features li { margin-bottom: 0.75rem; display: flex; align-items: center; gap: 0.75rem; }
        .tier-features i { color: var(--success); }
        .btn-subscribe {
            width: 100%;
            padding: 1rem;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
        }
        .btn-subscribe:hover { transform: translateY(-3px); box-shadow: 0 10px 25px rgba(202,138,4,0.4); }

        /* ---------- FOOTER ---------- */
        footer {
            background: linear-gradient(135deg, #0a0a0a, #111);
            color: white;
            padding: 5rem 1.5rem 2rem;
            border-top: 4px solid transparent;
            background-image: linear-gradient(#0a0a0a, #0a0a0a), repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 5px, var(--gold-dark) 5px, var(--gold-dark) 10px, transparent 10px, transparent 15px);
        }
        .footer-container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(250px,1fr)); gap: 3rem; }
        .footer-column a { color: rgba(255,255,255,0.7); display: block; text-decoration: none; margin-bottom: 0.75rem; transition: var(--transition); }
        .footer-column a:hover { color: var(--gold); transform: translateX(5px); }
        .copyright { text-align: center; margin-top: 4rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.1); color: rgba(255,255,255,0.5); }

        /* ---------- MODALS ---------- */
        .modal-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(15px);
            display: flex; align-items: center; justify-content: center;
            z-index: 2000; opacity: 0; visibility: hidden;
            transition: var(--transition);
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: 3rem;
            max-width: 500px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
            border: 3px solid transparent;
            background: linear-gradient(white, var(--african-pattern-bg)) padding-box,
                        repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 8px, var(--gold-dark) 8px, var(--gold-dark) 16px) border-box;
            position: relative;
        }
        .modal-close {
            position: absolute;
            top: 1.5rem; right: 1.5rem;
            width: 40px; height: 40px;
            border-radius: 50%;
            background: rgba(202,138,4,0.1);
            border: 2px solid rgba(202,138,4,0.3);
            color: var(--gold);
            font-size: 1.25rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
        }
        .modal-close:hover { background: var(--gold); color: white; transform: rotate(90deg); }
        .modal-title { font-family: 'Cinzel', serif; font-size: 1.75rem; margin-bottom: 1rem; color: var(--black); }
        .form-input, .form-select {
            width: 100%;
            padding: 0.875rem 1.25rem;
            border: 2px solid rgba(202,138,4,0.2);
            border-radius: var(--radius-md);
            font-family: 'Inter', sans-serif;
            margin-bottom: 1rem;
        }
        .form-input:focus { border-color: var(--gold); outline: none; box-shadow: 0 0 0 3px rgba(202,138,4,0.1); }

        /* ---------- MOBILE ---------- */
        @media (max-width: 992px) {
            .nav-container { display: none; }
            .mobile-menu-toggle { display: flex; }
            .publications-grid { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body>
    <!-- LOADING OVERLAY -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="quote-container">
            <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
            <div class="quote-text" id="quoteText"></div>
            <div class="quote-author" style="color: var(--gold-light); margin-top: 2rem;">
                - Mugera W.
                <span style="display: block; font-size: 0.9rem; color: rgba(255,255,255,0.7);">Transformational Leadership Expert & Author</span>
            </div>
        </div>
    </div>

    <!-- HEADER -->
    <header id="mainHeader">
        <div class="header-container">
            <a href="/"><img src="https://i.postimg.cc/Kzsb3tX6/I-AM-MUGERA.png" class="brand-logo" alt="I AM MUGERA"></a>
            <div class="nav-container">
                <nav>
                    <ul class="main-nav">
                        <li class="nav-item"><a href="#library" class="nav-link"><i class="fas fa-book-open"></i> Library</a></li>
                        <li class="nav-item"><a href="#series" class="nav-link"><i class="fas fa-layer-group"></i> Series</a></li>
                        <li class="nav-item"><a href="#subscription" class="nav-link"><i class="fas fa-crown"></i> Subscribe</a></li>
                        <li class="nav-item"><a href="reader.html" class="nav-link"><i class="fas fa-book-reader"></i> My Library</a></li>
                    </ul>
                </nav>
                <div class="user-menu">
                    <div class="user-avatar" id="userAvatar" onclick="toggleUserMenu()">G</div>
                </div>
            </div>
            <button class="mobile-menu-toggle" id="mobileMenuToggle"><span></span></button>
        </div>
    </header>

    <!-- USER DROPDOWN -->
    <div class="user-dropdown" id="userDropdown">
        <div id="userInfo">
            <p style="font-weight: 700; margin-bottom: 0.5rem;">Guest User</p>
            <p style="color: var(--dark-gray); font-size: 0.9rem;">Sign in to access your library</p>
            <button class="btn-subscribe" style="margin-top: 1.5rem;" onclick="window.location.href='login.html'">
                <i class="fas fa-sign-in-alt"></i> Sign In / Register
            </button>
        </div>
    </div>

    <!-- MAIN CONTENT -->
    <main id="mainContent"></main>

    <!-- FOOTER -->
    <footer id="mainFooter"></footer>

    <!-- WAITLIST MODAL -->
    <div class="modal-overlay" id="waitlistModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('waitlistModal')">&times;</button>
            <h2 class="modal-title" id="waitlistModalTitle">Join Waitlist</h2>
            <p id="waitlistModalSubtitle" style="color: var(--dark-gray); margin-bottom: 2rem;">Be first to access this publication</p>
            <form id="waitlistForm">
                <input type="hidden" id="waitlistPublicationId">
                <input type="hidden" id="waitlistPublicationTitle">
                <input type="text" class="form-input" id="waitlistName" placeholder="Full Name *" required>
                <input type="email" class="form-input" id="waitlistEmail" placeholder="Email Address *" required>
                <input type="text" class="form-input" id="waitlistProfession" placeholder="Profession (Optional)">
                <select class="form-select" id="waitlistInterest">
                    <option value="">Select your primary interest</option>
                    <option value="spiritual">Spiritual dimensions</option>
                    <option value="scientific">Scientific aspects</option>
                    <option value="philosophical">Philosophical exploration</option>
                    <option value="personal-growth">Personal growth</option>
                    <option value="all">All aspects</option>
                </select>
                <button type="submit" class="btn-subscribe" style="margin-top: 1.5rem;">
                    <i class="fas fa-bell"></i> Join Waitlist
                </button>
            </form>
            <div id="waitlistSuccess" style="display: none; text-align: center; padding: 2rem;">
                <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--success); margin-bottom: 1rem;"></i>
                <h3 style="color: var(--black);">You're on the list!</h3>
                <p style="color: var(--dark-gray); margin-top: 1rem;">We'll notify you when this publication is available.</p>
            </div>
        </div>
    </div>

    <!-- SUBSCRIPTION MODAL -->
    <div class="modal-overlay" id="subscriptionModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('subscriptionModal')">&times;</button>
            <h2 class="modal-title" id="subscriptionModalTitle">Choose Your Plan</h2>
            <div id="subscriptionTiersContainer"></div>
        </div>
    </div>

    <script>
        // ------------------------------------------------------------
        // FIREBASE CONFIG – YOUR EXACT CREDENTIALS
        // ------------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyC7kppUyHUaPzeLBV62NEZWuHiuz1Kz0mA",
            authDomain: "mugera-e51cc.firebaseapp.com",
            databaseURL: "https://mugera-e51cc-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mugera-e51cc",
            storageBucket: "mugera-e51cc.firebasestorage.app",
            messagingSenderId: "1024868637509",
            appId: "1:1024868637509:web:321faecddce8f11d9cfc2c"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        const auth = firebase.auth();

        // ---------- GLOBAL STATE – FULL AUTHOR ECOSYSTEM ----------
        let brandData = null;
        let publicationsWorks = [];      // publications.works (full rich content)
        let authorBooks = [];           // author.books (legacy)
        let seriesArray = [];           // publications.series
        let collectionsArray = [];      // publications.collections
        let subscriptionTiers = [];     // publications.subscriptionTiers
        let featuredArticle = null;
        let currentUser = null;
        let userData = null;           // reader account data

        // ---------- TYPING ANIMATION ----------
        function startTypingAnimation() {
            const quote = "Humans are very special and blessed beings, they just need to be reminded time and again.";
            const quoteText = document.getElementById('quoteText');
            const typingContainer = document.createElement('div');
            typingContainer.className = 'typing-container';
            quoteText.innerHTML = '';
            quoteText.appendChild(typingContainer);
            
            let charIndex = 0;
            function typeCharacter() {
                if (charIndex < quote.length) {
                    typingContainer.innerHTML = quote.substring(0, charIndex + 1) + '<span class="cursor"></span>';
                    charIndex++;
                    setTimeout(typeCharacter, 50);
                } else {
                    typingContainer.innerHTML = quote + '<span class="cursor"></span>';
                    setTimeout(() => { loadAllContent(); }, 1000);
                }
            }
            typeCharacter();
        }

        // ---------- LOAD EVERYTHING FROM FIREBASE ----------
        async function loadAllContent() {
            try {
                const snap = await database.ref('iam-mugera').once('value');
                brandData = snap.val() || {};

                // 1. publications.works – FULL RICH CONTENT
                publicationsWorks = [];
                if (brandData.publications?.works) {
                    Object.entries(brandData.publications.works).forEach(([id, work]) => {
                        publicationsWorks.push({ 
                            id, 
                            ...work,
                            // Ensure rich content fields exist
                            content: work.content || { format: 'prosemirror', chapters: [] },
                            access: work.access || { freePreview: true, fullAccess: 'subscription' },
                            metadata: work.metadata || {},
                            stats: work.stats || { reads: 0, ratings: 0 }
                        });
                    });
                }

                // 2. author.books (legacy)
                authorBooks = [];
                if (brandData.author?.books) {
                    Object.entries(brandData.author.books).forEach(([id, b]) => {
                        authorBooks.push({ id, ...b, type: 'book (legacy)' });
                    });
                }

                // 3. series & collections
                seriesArray = brandData.publications?.series ? 
                    Object.entries(brandData.publications.series).map(([id,s]) => ({id, ...s})) : [];
                collectionsArray = brandData.publications?.collections ? 
                    Object.entries(brandData.publications.collections).map(([id,c]) => ({id, ...c})) : [];

                // 4. subscription tiers
                subscriptionTiers = brandData.publications?.subscriptionTiers || {};

                // 5. featured article
                featuredArticle = brandData.author?.featuredArticle || null;

                // 6. check current user and load their data
                auth.onAuthStateChanged(async (user) => {
                    currentUser = user;
                    if (user) {
                        const userSnap = await database.ref(`iam-mugera/readers/${user.uid}`).once('value');
                        userData = userSnap.val() || null;
                        updateUserInterface();
                    } else {
                        userData = null;
                        updateUserInterface();
                    }
                });

                // RENDER EVERYTHING
                renderHero();
                renderLibrary();        // COMPLETE PUBLICATIONS GRID
                renderSeriesCollections();
                renderSubscriptionTiers();
                renderFooter();

                // Hide loading overlay
                setTimeout(() => {
                    document.getElementById('loadingOverlay').style.opacity = '0';
                    document.getElementById('loadingOverlay').style.visibility = 'hidden';
                }, 500);

            } catch (e) {
                console.error('Error loading content:', e);
                document.getElementById('loadingOverlay').style.display = 'none';
            }
        }

        // ---------- RENDER HERO ----------
        function renderHero() {
            const hero = brandData.hero || {};
            const main = document.getElementById('mainContent');
            main.innerHTML = `
                <section class="hero" id="home">
                    <div class="hero-content">
                        <div class="hero-text-container">
                            <div class="hero-tagline" style="color: var(--gold);">${hero.tagline || 'Transformative Speaking • Strategic Coaching • Impactful Writing'}</div>
                            <h1 class="cinzel-font" style="color: white; font-size: 3rem;">${hero.mainTitle || 'I AM MUGERA'}</h1>
                            <div style="color: rgba(255,255,255,0.9); font-size: 1.2rem; margin: 1.5rem 0;">${hero.subtitle || 'Stop waiting for inspiration. Start writing the script. For your family, your team, your legacy.'}</div>
                            <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                                <button class="cta-button" onclick="document.getElementById('library').scrollIntoView({behavior: 'smooth'})">
                                    <i class="fas fa-book-open"></i> Explore Library
                                </button>
                                <button class="cta-button outline" onclick="document.getElementById('subscription').scrollIntoView({behavior: 'smooth'})">
                                    <i class="fas fa-crown"></i> Subscribe
                                </button>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        // ---------- RENDER COMPLETE PUBLICATIONS LIBRARY ----------
        function renderLibrary() {
            const main = document.getElementById('mainContent');
            
            // Combine all works from publications.works AND author.books
            let allWorks = [...publicationsWorks];
            
            // Add legacy books if not already in publications
            authorBooks.forEach(book => {
                if (!allWorks.find(w => w.title === book.title)) {
                    allWorks.push({
                        id: book.id,
                        title: book.title,
                        description: book.description,
                        status: book.status,
                        type: 'book',
                        access: { fullAccess: book.status === 'coming-soon' ? 'waitlist' : 'free' }
                    });
                }
            });

            // Sort: coming soon first, then by title
            allWorks.sort((a, b) => {
                if (a.status === 'coming-soon' && b.status !== 'coming-soon') return -1;
                if (a.status !== 'coming-soon' && b.status === 'coming-soon') return 1;
                return (a.title || '').localeCompare(b.title || '');
            });

            const librarySection = document.createElement('section');
            librarySection.className = 'library-section';
            librarySection.id = 'library';
            librarySection.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <div class="library-header">
                        <h2 class="cinzel-font" style="font-size: 2.2rem;"><span class="highlight">Author</span> Library</h2>
                        <div class="library-filters" id="libraryFilters">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="book">Books</button>
                            <button class="filter-btn" data-filter="article">Articles</button>
                            <button class="filter-btn" data-filter="coming-soon">Coming Soon</button>
                            <button class="filter-btn" data-filter="premium">Premium</button>
                            <button class="filter-btn" data-filter="free">Free</button>
                        </div>
                    </div>
                    <div id="publicationsContainer" class="publications-grid"></div>
                </div>
            `;
            main.appendChild(librarySection);

            // Render publications grid
            renderPublicationsGrid(allWorks);

            // Add filter event listeners
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filterPublications(this.dataset.filter);
                });
            });
        }

        function renderPublicationsGrid(works) {
            const container = document.getElementById('publicationsContainer');
            if (!container) return;
            
            container.innerHTML = '';
            
            works.forEach(work => {
                // Determine badge and styling based on status/access
                let badgeClass = '';
                let badgeText = '';
                let buttonClass = '';
                let buttonText = '';
                let buttonIcon = '';
                let buttonAction = '';

                if (work.status === 'coming-soon') {
                    badgeClass = 'badge-coming-soon';
                    badgeText = 'Coming Soon';
                    buttonClass = 'btn-publication waitlist';
                    buttonText = 'Notify Me';
                    buttonIcon = 'fa-bell';
                    buttonAction = `openWaitlistModal('${work.id}', '${work.title.replace(/'/g, "\\'")}')`;
                } else if (work.status === 'premium' || work.access?.fullAccess === 'subscription') {
                    badgeClass = 'badge-premium';
                    badgeText = 'Premium';
                    buttonClass = 'btn-publication premium';
                    buttonText = 'Subscribe to Read';
                    buttonIcon = 'fa-crown';
                    buttonAction = `openSubscriptionModal('${work.id}')`;
                } else if (work.status === 'free' || work.access?.fullAccess === 'free') {
                    badgeClass = 'badge-free';
                    badgeText = 'Free';
                    buttonClass = 'btn-publication free';
                    buttonText = 'Read Now';
                    buttonIcon = 'fa-book-open';
                    buttonAction = `window.location.href='reader.html?id=${work.id}'`;
                } else if (work.status === 'serialized') {
                    badgeClass = 'badge-serialized';
                    badgeText = 'Serialized';
                    buttonClass = 'btn-publication free';
                    buttonText = 'Read Latest';
                    buttonIcon = 'fa-newspaper';
                    buttonAction = `window.location.href='reader.html?id=${work.id}'`;
                } else {
                    badgeClass = 'badge-coming-soon';
                    badgeText = work.status || 'Draft';
                    buttonClass = 'btn-publication waitlist';
                    buttonText = 'Learn More';
                    buttonIcon = 'fa-info-circle';
                    buttonAction = `openRegistrationModal()`;
                }

                // Format reading time
                const readingTime = work.metadata?.readingTime || 
                    (work.metadata?.wordCount ? `${Math.ceil(work.metadata.wordCount / 200)} min` : 'N/A');

                // Chapter count
                const chapterCount = work.metadata?.chapterCount || 
                    (work.content?.chapters?.length || 0);

                const card = document.createElement('div');
                card.className = 'publication-card';
                card.dataset.type = work.type || 'book';
                card.dataset.status = work.status || 'draft';
                card.dataset.access = work.access?.fullAccess || 'free';
                
                card.innerHTML = `
                    <span class="publication-badge ${badgeClass}">${badgeText}</span>
                    <span class="publication-type"><i class="fas fa-${work.type === 'article' ? 'newspaper' : 'book'}"></i> ${work.type || 'work'}</span>
                    <h3 class="publication-title">${work.title || 'Untitled'}</h3>
                    ${work.subtitle ? `<div class="publication-subtitle">${work.subtitle}</div>` : ''}
                    <div class="publication-meta">
                        ${chapterCount ? `<span><i class="fas fa-file-alt"></i> ${chapterCount} chapters</span>` : ''}
                        ${readingTime !== 'N/A' ? `<span><i class="fas fa-clock"></i> ${readingTime}</span>` : ''}
                        ${work.stats?.reads ? `<span><i class="fas fa-eye"></i> ${work.stats.reads} reads</span>` : ''}
                        ${work.stats?.ratings ? `<span><i class="fas fa-star" style="color: var(--gold);"></i> ${work.stats.ratings}</span>` : ''}
                    </div>
                    <p class="publication-description">${work.description || work.subtitle || 'No description available.'}</p>
                    <div class="publication-footer">
                        <span class="reading-time"><i class="fas fa-hourglass-half"></i> ${readingTime}</span>
                        <button class="${buttonClass}" onclick="${buttonAction}">
                            <i class="fas ${buttonIcon}"></i> ${buttonText}
                        </button>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function filterPublications(filter) {
            let allWorks = [...publicationsWorks];
            
            // Add legacy books
            authorBooks.forEach(book => {
                if (!allWorks.find(w => w.title === book.title)) {
                    allWorks.push({ ...book, type: 'book' });
                }
            });

            let filtered = allWorks;
            if (filter === 'book') {
                filtered = allWorks.filter(w => w.type === 'book' || w.type === 'book (legacy)');
            } else if (filter === 'article') {
                filtered = allWorks.filter(w => w.type === 'article');
            } else if (filter === 'coming-soon') {
                filtered = allWorks.filter(w => w.status === 'coming-soon');
            } else if (filter === 'premium') {
                filtered = allWorks.filter(w => w.status === 'premium' || w.access?.fullAccess === 'subscription');
            } else if (filter === 'free') {
                filtered = allWorks.filter(w => w.status === 'free' || w.access?.fullAccess === 'free');
            }
            
            renderPublicationsGrid(filtered);
        }

        // ---------- RENDER SERIES & COLLECTIONS ----------
        function renderSeriesCollections() {
            if (seriesArray.length === 0 && collectionsArray.length === 0) return;
            
            const main = document.getElementById('mainContent');
            const section = document.createElement('section');
            section.className = 'series-section';
            section.id = 'series';
            
            let seriesHtml = '';
            seriesArray.forEach(series => {
                seriesHtml += `
                    <div class="series-card">
                        <h3 class="series-name">${series.name}</h3>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">${series.description || ''}</p>
                        <span class="series-work-count">${series.works?.length || 0} works</span>
                        ${series.bundle?.available ? 
                            `<button class="btn-subscribe" style="margin-top: 1.5rem; background: var(--gold);" onclick="openSubscriptionModal()">
                                <i class="fas fa-gift"></i> Bundle Offer
                            </button>` : ''}
                    </div>
                `;
            });

            section.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <div class="section-header" style="text-align: center;">
                        <h2 class="cinzel-font" style="color: white; font-size: 2rem;">Series & Collections</h2>
                        <p style="color: rgba(255,255,255,0.8); margin-top: 1rem;">Curated reading journeys</p>
                    </div>
                    <div class="series-grid">
                        ${seriesHtml || '<p style="color: white; text-align: center;">No series available.</p>'}
                    </div>
                </div>
            `;
            main.appendChild(section);
        }

        // ---------- RENDER SUBSCRIPTION TIERS ----------
        function renderSubscriptionTiers() {
            const tiers = subscriptionTiers;
            if (Object.keys(tiers).length === 0) return;

            const main = document.getElementById('mainContent');
            const section = document.createElement('section');
            section.className = 'subscription-section';
            section.id = 'subscription';
            
            let tiersHtml = '';
            Object.entries(tiers).forEach(([id, tier]) => {
                const isRecommended = tier.recommended || id === 'premium';
                tiersHtml += `
                    <div class="tier-card" style="position: relative;">
                        ${isRecommended ? '<div class="tier-recommended">RECOMMENDED</div>' : ''}
                        <div class="tier-name">${tier.name}</div>
                        <div class="tier-price">
                            ${tier.price?.KSh ? `KSh ${tier.price.KSh}` : ''}
                            <span>/${tier.interval || 'month'}</span>
                        </div>
                        <ul class="tier-features">
                            ${tier.features ? tier.features.map(f => `<li><i class="fas fa-check-circle"></i> ${f}</li>`).join('') : ''}
                        </ul>
                        <button class="btn-subscribe" onclick="openCheckout('${id}')">
                            ${tier.buttonText || 'Subscribe Now'}
                        </button>
                    </div>
                `;
            });

            section.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <div class="section-header" style="text-align: center;">
                        <h2 class="cinzel-font" style="font-size: 2rem;"><span class="highlight">Membership</span> Plans</h2>
                        <p class="section-subtitle">Unlock premium content and exclusive benefits</p>
                    </div>
                    <div class="tiers-grid">
                        ${tiersHtml}
                    </div>
                </div>
            `;
            main.appendChild(section);
        }

        // ---------- RENDER FOOTER ----------
        function renderFooter() {
            const footer = document.getElementById('mainFooter');
            const f = brandData.footer || {};
            footer.innerHTML = `
                <div class="footer-container">
                    <div class="footer-column">
                        <h3 style="color: white; margin-bottom: 1.5rem;">I AM MUGERA</h3>
                        <p style="color: rgba(255,255,255,0.7);">${f.description || 'Transformative Speaking, Life Coaching & Authorship'}</p>
                    </div>
                    <div class="footer-column">
                        <h3 style="color: white; margin-bottom: 1.5rem;">Communities</h3>
                        ${f.communities ? Object.values(f.communities).map(c => `<a href="${c.url || '#'}">${c.title}</a>`).join('') : ''}
                    </div>
                    <div class="footer-column">
                        <h3 style="color: white; margin-bottom: 1.5rem;">Contact</h3>
                        <p style="color: rgba(255,255,255,0.7);">${f.contactInfo?.email || ''}<br>${f.contactInfo?.phone || ''}<br>${f.contactInfo?.location || ''}</p>
                    </div>
                </div>
                <div class="copyright">
                    ${f.copyright || '© 2026 I AM MUGERA. All rights reserved.'}
                </div>
            `;
        }

        // ---------- WAITLIST MODAL – PER PUBLICATION ----------
        window.openWaitlistModal = function(publicationId, publicationTitle) {
            document.getElementById('waitlistPublicationId').value = publicationId || '';
            document.getElementById('waitlistPublicationTitle').value = publicationTitle || '';
            document.getElementById('waitlistModalTitle').innerText = `Join Waitlist: ${publicationTitle || 'Publication'}`;
            document.getElementById('waitlistModalSubtitle').innerText = `Be first to access "${publicationTitle || 'this publication'}"`;
            document.getElementById('waitlistForm').style.display = 'block';
            document.getElementById('waitlistSuccess').style.display = 'none';
            document.getElementById('waitlistModal').classList.add('active');
        };

        // Waitlist form submission
        document.getElementById('waitlistForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            const submitBtn = e.target.querySelector('button[type="submit"]');
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';

            const waitlistData = {
                publicationId: document.getElementById('waitlistPublicationId').value,
                publicationTitle: document.getElementById('waitlistPublicationTitle').value,
                fullName: document.getElementById('waitlistName').value,
                email: document.getElementById('waitlistEmail').value,
                profession: document.getElementById('waitlistProfession').value,
                interest: document.getElementById('waitlistInterest').value,
                timestamp: new Date().toISOString(),
                source: 'author_publication_waitlist',
                status: 'waiting',
                userId: currentUser?.uid || null
            };

            try {
                const waitlistId = 'waitlist_' + Date.now() + '_' + Math.random().toString(36).substr(2, 6);
                await database.ref(`waitlists/${waitlistId}`).set(waitlistData);
                
                document.getElementById('waitlistForm').style.display = 'none';
                document.getElementById('waitlistSuccess').style.display = 'block';
                
                setTimeout(() => {
                    closeModal('waitlistModal');
                }, 3000);
            } catch (error) {
                alert('Error joining waitlist. Please try again.');
                console.error(error);
            } finally {
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fas fa-bell"></i> Join Waitlist';
            }
        });

        // ---------- USER MENU ----------
        window.toggleUserMenu = function() {
            document.getElementById('userDropdown').classList.toggle('active');
        };

        function updateUserInterface() {
            const avatar = document.getElementById('userAvatar');
            const userInfo = document.getElementById('userInfo');
            
            if (currentUser) {
                avatar.innerText = (currentUser.email || 'U').charAt(0).toUpperCase();
                userInfo.innerHTML = `
                    <p style="font-weight: 700; margin-bottom: 0.25rem;">${userData?.fullName || currentUser.email}</p>
                    ${userData?.subscription?.tier ? 
                        `<span class="subscription-badge">${userData.subscription.tier} Member</span>` : 
                        '<span style="color: var(--dark-gray); font-size: 0.9rem;">Free Member</span>'}
                    <hr style="margin: 1rem 0; border: none; border-top: 1px solid var(--light-gray);">
                    <a href="reader.html" style="display: block; text-decoration: none; color: var(--black); padding: 0.5rem 0;">
                        <i class="fas fa-book-open"></i> My Library
                    </a>
                    <a href="reader.html?progress=true" style="display: block; text-decoration: none; color: var(--black); padding: 0.5rem 0;">
                        <i class="fas fa-chart-line"></i> Reading Progress
                    </a>
                    <button class="btn-subscribe" style="margin-top: 1rem; background: var(--error);" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> Sign Out
                    </button>
                `;
            } else {
                avatar.innerText = 'G';
                userInfo.innerHTML = `
                    <p style="font-weight: 700; margin-bottom: 0.5rem;">Guest User</p>
                    <p style="color: var(--dark-gray); font-size: 0.9rem;">Sign in to access your library and track progress</p>
                    <button class="btn-subscribe" style="margin-top: 1.5rem;" onclick="window.location.href='login.html'">
                        <i class="fas fa-sign-in-alt"></i> Sign In / Register
                    </button>
                `;
            }
        }

        window.logout = function() {
            auth.signOut().then(() => {
                window.location.reload();
            });
        };

        // ---------- MODAL UTILITIES ----------
        window.closeModal = function(modalId) {
            document.getElementById(modalId).classList.remove('active');
        };

        window.openSubscriptionModal = function(workId) {
            document.getElementById('subscriptionModal').classList.add('active');
        };

        window.openCheckout = function(tierId) {
            if (!currentUser) {
                alert('Please sign in to subscribe.');
                window.location.href = 'login.html';
                return;
            }
            // Redirect to checkout page with tier selection
            window.location.href = `checkout.html?tier=${tierId}`;
        };

        // ---------- INITIALIZE ----------
        document.addEventListener('DOMContentLoaded', function() {
            startTypingAnimation();
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.user-menu') && !e.target.closest('.user-dropdown')) {
                    document.getElementById('userDropdown')?.classList.remove('active');
                }
            });
        });

        // Close modals on escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
    </script>
</body>
</html>
