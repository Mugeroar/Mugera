<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=1.0, user-scalable=no">
    <title>Mugera W. · Author Library</title>
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/Kzsb3tX6/I-AM-MUGERA.png">
    <!-- Font Awesome 6 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&family=Cinzel:wght@400;500;600;700;800&family=Lora:wght@400;600;700&display=swap" rel="stylesheet">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    
    <style>
        /* ---------- PURE AUTHOR PROFILE – NO SUBSCRIPTION/COMMERCIAL ---------- */
        :root {
            --black: #0a0a0a;
            --white: #ffffff;
            --gray: #f9f9f9;
            --dark-gray: #1a1a1a;
            --light-gray: #e8e8e8;
            --gold: #ca8a04;
            --gold-light: #fef3c7;
            --gold-dark: #a16207;
            --african-brown: #8B4513;
            --african-red: #B22222;
            --african-earth: #D2691E;
            --african-pattern-bg: #faf7f2;
            --success: #10b981;
            --error: #ef4444;
            --info: #3b82f6;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.08);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1);
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-full: 9999px;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; scroll-padding-top: 80px; font-size: 15px; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: var(--white);
            color: var(--black);
            line-height: 1.6;
            overflow-x: hidden;
        }
        .cinzel { font-family: 'Cinzel', serif; font-weight: 600; letter-spacing: 0.5px; }
        .lora { font-family: 'Lora', serif; }
        .highlight { 
            color: var(--gold); 
            position: relative; 
            display: inline-block; 
        }
        .highlight::after { 
            content: ''; 
            position: absolute; 
            bottom: 2px; 
            left: 0; 
            width: 100%; 
            height: 6px; 
            background-color: var(--gold); 
            opacity: 0.2; 
            z-index: -1; 
            border-radius: 4px; 
        }

        /* ----- LOADING (SIGNATURE QUOTE) ----- */
        .loading-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: linear-gradient(135deg, #0a0a0a 0%, #1e1e1e 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 9999;
        }
        .loading-spinner {
            width: 70px; height: 70px;
            border: 3px solid rgba(202, 138, 4, 0.1);
            border-top: 3px solid var(--gold);
            border-radius: 50%;
            animation: spin 1.2s cubic-bezier(0.68, -0.55, 0.27, 1.55) infinite;
            margin-bottom: 2rem;
            box-shadow: 0 0 30px rgba(202,138,4,0.2);
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .quote-container { text-align: center; max-width: 800px; padding: 2rem; }
        .quote-icon { font-size: 3rem; color: var(--gold); margin-bottom: 1rem; opacity: 0.7; animation: pulse 2s infinite; }
        @keyframes pulse { 0%,100% { opacity:0.5; } 50% { opacity:1; } }
        .quote-text { font-family: 'Cinzel', serif; font-size: 2.1rem; line-height: 1.4; color: white; min-height: 140px; }
        .typing-container { display: inline-block; text-align: left; }
        .cursor { display: inline-block; width: 3px; height: 2.2rem; background: var(--gold); margin-left: 4px; animation: blink 1s infinite; vertical-align: middle; }
        @keyframes blink { 0%,50% { opacity:1; } 51%,100% { opacity:0; } }

        /* ----- HEADER – AUTHOR BRANDING ----- */
        header {
            position: fixed; top: 0; width: 100%; z-index: 1000;
            background: rgba(255,255,255,0.98); backdrop-filter: blur(20px);
            height: 80px;
            border-bottom: 3px solid transparent;
            background-image: linear-gradient(white,white), 
                repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 4px, var(--gold-dark) 4px, var(--gold-dark) 8px, transparent 8px, transparent 12px);
            background-clip: padding-box, border-box;
            box-shadow: var(--shadow-sm);
        }
        .header-container { max-width: 1200px; margin: 0 auto; padding: 0 1.5rem; display: flex; align-items: center; justify-content: space-between; height: 100%; }
        .brand-logo { height: 52px; width: auto; border-radius: 8px; padding: 4px; background: white; border: 1px solid rgba(202,138,4,0.2); }
        .main-nav { display: flex; list-style: none; gap: 1.8rem; }
        .nav-link { text-decoration: none; color: var(--dark-gray); font-weight: 600; font-size: 0.95rem; display: flex; align-items: center; gap: 0.5rem; transition: var(--transition); }
        .nav-link:hover { color: var(--gold); }
        .nav-link.active { color: var(--gold); border-bottom: 3px solid var(--gold); padding-bottom: 0.25rem; }

        /* ----- HERO – AUTHOR IDENTITY (NO CTA TO BUY) ----- */
        .hero {
            min-height: 65vh;
            display: flex;
            align-items: center;
            background: url('https://i.postimg.cc/fyxmyB9n/20260204-1035-Image-Generation-remix-01kgks60qgeata5pv0jy8vkg0d.png');
            background-size: 420px 420px;
            background-attachment: fixed;
            color: white;
            padding: 6rem 1.5rem 3rem;
            position: relative;
        }
        .hero::before {
            content: ''; position: absolute; top:0; left:0; right:0; bottom:0;
            background: linear-gradient(135deg, rgba(0,0,0,0.9), rgba(10,10,10,0.8));
            z-index:1;
        }
        .hero-content { max-width: 1000px; margin: 0 auto; position: relative; z-index: 3; }
        .hero-text-container { 
            padding: 2.5rem; 
            background: rgba(0,0,0,0.35); 
            backdrop-filter: blur(16px); 
            border-radius: var(--radius-xl); 
            border: 1px solid rgba(202,138,4,0.3);
        }
        .author-signature { font-family: 'Cinzel', serif; color: var(--gold); font-size: 1.2rem; margin-bottom: 0.5rem; }
        .hero-bio {
            font-size: 1.2rem; 
            color: rgba(255,255,255,0.95);
            max-width: 700px;
            border-left: 4px solid var(--gold);
            padding-left: 1.5rem;
            margin-top: 1.2rem;
            font-style: italic;
        }

        /* ----- LIBRARY – PURE PUBLICATIONS, NO SUBSCRIPTION ----- */
        .library-section {
            padding: 5rem 1.5rem;
            background: linear-gradient(to bottom, var(--african-pattern-bg), white);
        }
        .library-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 2.5rem;
        }
        .library-filters {
            display: flex;
            gap: 0.75rem;
            flex-wrap: wrap;
        }
        .filter-btn {
            padding: 0.5rem 1.25rem;
            border: 2px solid rgba(202,138,4,0.3);
            background: transparent;
            border-radius: var(--radius-full);
            font-weight: 600;
            color: var(--dark-gray);
            cursor: pointer;
            transition: var(--transition);
            font-size: 0.85rem;
        }
        .filter-btn.active, .filter-btn:hover {
            background: var(--gold);
            color: white;
            border-color: var(--gold);
        }
        .publications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(360px, 1fr));
            gap: 2.2rem;
            margin-top: 2rem;
        }
        .publication-card {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: 2rem 1.8rem;
            box-shadow: var(--shadow-lg);
            transition: var(--transition);
            border: 2px solid transparent;
            background: linear-gradient(var(--white), var(--white)) padding-box,
                        repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 5px, var(--gold-dark) 5px, var(--gold-dark) 10px, transparent 10px, transparent 14px) border-box;
            position: relative;
            display: flex;
            flex-direction: column;
        }
        .publication-card:hover { transform: translateY(-6px); box-shadow: var(--shadow-xl); }
        .publication-badge {
            position: absolute;
            top: 1rem; right: 1rem;
            padding: 0.35rem 1.1rem;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .badge-essay { background: #e2e8f0; color: #1e293b; }
        .badge-article { background: #dbeafe; color: #1e40af; }
        .badge-book { background: #fef3c7; color: #92400e; }
        .badge-serial { background: #e0e7ff; color: #3730a3; }
        .badge-coming-soon { background: #f1f5f9; color: #334155; border: 1px dashed var(--gold); }
        
        .publication-type {
            display: inline-block;
            padding: 0.25rem 1rem;
            background: rgba(202,138,4,0.08);
            color: var(--gold-dark);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 1rem;
            align-self: flex-start;
            text-transform: uppercase;
        }
        .publication-title {
            font-size: 1.6rem;
            font-weight: 700;
            font-family: 'Cinzel', serif;
            color: var(--black);
            line-height: 1.3;
            margin-bottom: 0.5rem;
        }
        .publication-subtitle {
            font-size: 0.95rem;
            color: var(--gold-dark);
            font-style: italic;
            margin-bottom: 1rem;
        }
        .publication-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1.2rem;
            margin: 1rem 0;
            color: var(--dark-gray);
            font-size: 0.85rem;
        }
        .publication-meta i { color: var(--gold); width: 16px; }
        .publication-description {
            color: #374151;
            line-height: 1.7;
            margin-bottom: 1.5rem;
            flex: 1;
        }
        .publication-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            padding-top: 1.25rem;
            border-top: 1px solid var(--light-gray);
        }
        .reading-time {
            display: flex;
            align-items: center;
            gap: 0.4rem;
            color: #4b5563;
            font-size: 0.8rem;
        }
        .btn-read {
            padding: 0.7rem 1.5rem;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: var(--dark-gray);
            color: white;
        }
        .btn-read:hover { background: var(--black); transform: translateY(-2px); box-shadow: var(--shadow-md); }
        .btn-waitlist {
            background: #8B5CF6;
            color: white;
        }
        .btn-waitlist:hover { background: #7c3aed; }

        /* ----- SERIES SECTION – AUTHOR'S COLLECTIONS (NO PRICING) ----- */
        .series-section {
            padding: 4rem 1.5rem;
            background: linear-gradient(145deg, #1e293b, #0f172a);
            color: white;
        }
        .series-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        .series-card {
            background: rgba(255,255,255,0.07);
            backdrop-filter: blur(8px);
            border-radius: var(--radius-lg);
            padding: 2rem;
            border: 1px solid rgba(202,138,4,0.2);
            transition: var(--transition);
        }
        .series-card:hover { border-color: var(--gold); background: rgba(255,255,255,0.1); }
        .series-name { font-size: 1.5rem; font-family: 'Cinzel', serif; color: var(--gold); margin-bottom: 0.75rem; }
        .series-work-count { display: inline-block; padding: 0.2rem 0.8rem; background: rgba(202,138,4,0.15); border-radius: var(--radius-full); font-size: 0.75rem; }

        /* ----- AUTHOR FOOTER – ONLY BIO & SOCIAL (NO SUBSCRIPTION) ----- */
        footer {
            background: linear-gradient(145deg, #0a0a0a, #151515);
            color: white;
            padding: 4rem 1.5rem 2rem;
            border-top: 4px solid transparent;
            background-image: linear-gradient(#0a0a0a, #0a0a0a), 
                repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 4px, var(--gold-dark) 4px, var(--gold-dark) 8px, transparent 8px, transparent 12px);
        }
        .footer-container { max-width: 1200px; margin: 0 auto; display: grid; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); gap: 3rem; }
        .footer-column a { color: rgba(255,255,255,0.7); display: block; text-decoration: none; margin-bottom: 0.5rem; transition: var(--transition); }
        .footer-column a:hover { color: var(--gold); transform: translateX(5px); }
        .copyright { text-align: center; margin-top: 3rem; padding-top: 2rem; border-top: 1px solid rgba(255,255,255,0.08); color: rgba(255,255,255,0.5); font-size: 0.9rem; }

        /* ----- MODAL – WAITLIST (LIGHT, NON-COMMERCIAL) ----- */
        .modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(12px);
            display: flex; align-items: center; justify-content: center;
            z-index: 2000; opacity: 0; visibility: hidden;
            transition: var(--transition);
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal-content {
            background: white;
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            max-width: 480px;
            width: 90%;
            border: 2px solid transparent;
            background: linear-gradient(white, #fffcf5) padding-box,
                        repeating-linear-gradient(45deg, var(--gold) 0px, var(--gold) 6px, var(--gold-dark) 6px, var(--gold-dark) 12px) border-box;
        }
        .modal-close {
            position: absolute; top: 1.2rem; right: 1.2rem;
            width: 36px; height: 36px;
            border-radius: 50%;
            background: rgba(202,138,4,0.1);
            border: 1px solid rgba(202,138,4,0.3);
            color: var(--gold);
            font-size: 1.2rem;
            cursor: pointer;
        }
        .form-input, .form-select {
            width: 100%; padding: 0.8rem 1.2rem;
            border: 2px solid rgba(202,138,4,0.15);
            border-radius: var(--radius-md);
            margin-bottom: 1rem;
        }
        .btn-modal {
            width: 100%; padding: 0.9rem;
            background: var(--gold);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 700;
        }

        /* ----- MOBILE ----- */
        @media (max-width: 800px) {
            .nav-container { display: none; }
            .publications-grid { grid-template-columns: 1fr; }
            .library-header { flex-direction: column; align-items: flex-start; gap: 1rem; }
        }
    </style>
</head>
<body>
    <!-- LOADING – Author's signature quote -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="quote-container">
            <div class="quote-icon"><i class="fas fa-quote-left"></i></div>
            <div class="quote-text" id="quoteText"></div>
            <div style="color: var(--gold-light); margin-top: 2rem; font-size: 1.2rem;">— Mugera W.</div>
            <div style="color: rgba(255,255,255,0.5); font-size: 0.9rem; margin-top: 0.5rem;">Author · Speaker · Transformational thinker</div>
        </div>
    </div>

    <!-- HEADER – Author-centric, no user/subscription menu -->
    <header id="mainHeader">
        <div class="header-container">
            <a href="#"><img src="https://i.postimg.cc/Kzsb3tX6/I-AM-MUGERA.png" class="brand-logo" alt="Mugera"></a>
            <div class="nav-container">
                <nav>
                    <ul class="main-nav">
                        <li><a href="#library" class="nav-link active"><i class="fas fa-book-open"></i> Library</a></li>
                        <li><a href="#series" class="nav-link"><i class="fas fa-layer-group"></i> Series</a></li>
                        <li><a href="#about-author" class="nav-link"><i class="fas fa-feather"></i> About</a></li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT (DYNAMICALLY BUILT BY FIREBASE) -->
    <main id="mainContent"></main>

    <!-- FOOTER (STATIC AUTHOR INFO, REPLACED VIA JS) -->
    <footer id="mainFooter"></footer>

    <!-- WAITLIST MODAL – purely for upcoming works, no payment -->
    <div class="modal-overlay" id="waitlistModal">
        <div class="modal-content" style="position: relative;">
            <button class="modal-close" onclick="closeModal('waitlistModal')">&times;</button>
            <h2 style="font-family: 'Cinzel'; margin-bottom: 0.5rem; color: var(--gold-dark);">Get notified</h2>
            <p style="margin-bottom: 1.8rem; color: var(--dark-gray);" id="waitlistModalSubtitle">Be among the first to read this work.</p>
            <form id="waitlistForm">
                <input type="hidden" id="waitlistPublicationId">
                <input type="hidden" id="waitlistPublicationTitle">
                <input type="text" class="form-input" id="waitlistName" placeholder="Your name" required>
                <input type="email" class="form-input" id="waitlistEmail" placeholder="Email address" required>
                <select class="form-select" id="waitlistInterest">
                    <option value="">Interested in...</option>
                    <option value="leadership">Leadership & legacy</option>
                    <option value="spiritual">Spiritual formation</option>
                    <option value="philosophical">Philosophical essays</option>
                    <option value="fiction">Narrative / fiction</option>
                </select>
                <button type="submit" class="btn-modal"><i class="fas fa-bell"></i> Notify me</button>
            </form>
            <div id="waitlistSuccess" style="display: none; text-align: center; padding: 1.5rem 0;">
                <i class="fas fa-check-circle" style="font-size: 3rem; color: var(--success);"></i>
                <h3 style="margin: 1rem 0 0.5rem;">You're on the list</h3>
                <p style="color: gray;">We'll email you when it's available.</p>
            </div>
        </div>
    </div>

    <script>
        // ------------------------------------------------------------
        // FIREBASE – EXACT CREDENTIALS (NO SUBSCRIPTION NODES)
        // ------------------------------------------------------------
        const firebaseConfig = {
            apiKey: "AIzaSyC7kppUyHUaPzeLBV62NEZWuHiuz1Kz0mA",
            authDomain: "mugera-e51cc.firebaseapp.com",
            databaseURL: "https://mugera-e51cc-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mugera-e51cc",
            storageBucket: "mugera-e51cc.firebasestorage.app",
            messagingSenderId: "1024868637509",
            appId: "1:1024868637509:web:321faecddce8f11d9cfc2c"
        };
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();
        // No auth reliance — pure author profile. We keep auth optional but never show subscription.

        // ---------- GLOBAL STATE – AUTHOR CONTENT ONLY ----------
        let publicationsWorks = [];    // publications.works (core)
        let authorBooks = [];         // legacy books
        let seriesArray = [];         // series
        let collectionsArray = [];
        let authorBio = null;

        // ---------- TYPING ANIMATION ----------
        function startTypingAnimation() {
            const quote = "Humans are very special and blessed beings, they just need to be reminded time and again.";
            const quoteText = document.getElementById('quoteText');
            const typingContainer = document.createElement('div');
            typingContainer.className = 'typing-container';
            quoteText.innerHTML = '';
            quoteText.appendChild(typingContainer);
            
            let charIndex = 0;
            function typeCharacter() {
                if (charIndex < quote.length) {
                    typingContainer.innerHTML = quote.substring(0, charIndex + 1) + '<span class="cursor"></span>';
                    charIndex++;
                    setTimeout(typeCharacter, 50);
                } else {
                    typingContainer.innerHTML = quote + '<span class="cursor"></span>';
                    setTimeout(() => { loadAuthorContent(); }, 900);
                }
            }
            typeCharacter();
        }

        // ---------- LOAD ONLY AUTHOR / PUBLICATION DATA (NO SUBSCRIPTION TIERS, NO COMMERCE) ----------
        async function loadAuthorContent() {
            try {
                const snap = await database.ref('iam-mugera').once('value');
                const brandData = snap.val() || {};

                // 1. publications.works – the heart of author library
                if (brandData.publications?.works) {
                    publicationsWorks = Object.entries(brandData.publications.works).map(([id, work]) => ({
                        id,
                        ...work,
                        type: work.type || (work.status === 'coming-soon' ? 'work' : 'book'),
                        content: work.content || {},
                        metadata: work.metadata || {},
                        stats: work.stats || {}
                    }));
                }

                // 2. author.books (legacy)
                authorBooks = [];
                if (brandData.author?.books) {
                    authorBooks = Object.entries(brandData.author.books).map(([id, b]) => ({ id, ...b, type: 'book' }));
                }

                // 3. series & collections (no pricing)
                seriesArray = brandData.publications?.series ? 
                    Object.entries(brandData.publications.series).map(([id,s]) => ({id, ...s})) : [];

                // 4. author info for bio/footer
                authorBio = brandData.author || {};

                // 5. RENDER EVERYTHING — PURE AUTHOR PROFILE
                renderAuthorHero(brandData.hero);
                renderLibrary();         // FULL PUBLICATIONS, NO SUBSCRIPTION MENTIONS
                renderSeriesCollections();
                renderAuthorFooter();

                // Hide loading
                document.getElementById('loadingOverlay').style.opacity = '0';
                document.getElementById('loadingOverlay').style.visibility = 'hidden';

            } catch (e) {
                console.error('Firebase error', e);
                document.getElementById('loadingOverlay').style.display = 'none';
                // fallback: render with sample works
                renderFallbackLibrary();
            }
        }

        // ----- HERO – strictly author, no CTA to subscribe -----
        function renderAuthorHero(heroData = {}) {
            const main = document.getElementById('mainContent');
            const tagline = heroData?.tagline || 'Transformational thinker · Author · Speaker';
            const mainTitle = 'I AM MUGERA';
            const bio = heroData?.subtitle || 'Stop waiting for inspiration. Start writing the script — for your family, your team, your legacy.';

            main.innerHTML = `
                <section class="hero" id="home">
                    <div class="hero-content">
                        <div class="hero-text-container">
                            <div class="author-signature"><i class="fas fa-quill"></i> Mugera W.</div>
                            <h1 class="cinzel" style="color: white; font-size: 3.2rem; margin-top: 0.2rem;">${mainTitle}</h1>
                            <div style="color: var(--gold); font-size: 1.2rem; letter-spacing: 1px; margin-top: 0.2rem;">${tagline}</div>
                            <div class="hero-bio">${bio}</div>
                            <div style="display: flex; gap: 1.2rem; margin-top: 2.5rem;">
                                <a href="#library" style="background: var(--gold); color: black; padding: 0.8rem 2rem; border-radius: 40px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.6rem;"><i class="fas fa-book-open"></i> Browse library</a>
                                <a href="#about-author" style="border: 2px solid var(--gold); color: white; padding: 0.8rem 2rem; border-radius: 40px; font-weight: 600; text-decoration: none; display: inline-flex; align-items: center; gap: 0.6rem;"><i class="fas fa-feather"></i> About the author</a>
                            </div>
                        </div>
                    </div>
                </section>
            `;
        }

        // ----- LIBRARY – PURE PUBLICATIONS, ALL SUBSCRIPTION / PREMIUM BADGES REMOVED -----
        function renderLibrary() {
            const main = document.getElementById('mainContent');
            
            // Combine works + legacy books, no duplicates
            let allWorks = [...publicationsWorks];
            authorBooks.forEach(book => {
                if (!allWorks.find(w => w.title === book.title)) {
                    allWorks.push({ ...book, id: book.id, type: 'book' });
                }
            });

            // Sort: coming-soon first, then title
            allWorks.sort((a,b) => {
                if (a.status === 'coming-soon' && b.status !== 'coming-soon') return -1;
                if (a.status !== 'coming-soon' && b.status === 'coming-soon') return 1;
                return (a.title || '').localeCompare(b.title || '');
            });

            const librarySection = document.createElement('section');
            librarySection.className = 'library-section';
            librarySection.id = 'library';
            librarySection.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <div class="library-header">
                        <h2 class="cinzel" style="font-size: 2.2rem;"><span class="highlight">Author</span> works</h2>
                        <div class="library-filters" id="libraryFilters">
                            <button class="filter-btn active" data-filter="all">All</button>
                            <button class="filter-btn" data-filter="book">Books</button>
                            <button class="filter-btn" data-filter="article">Articles</button>
                            <button class="filter-btn" data-filter="essay">Essays</button>
                            <button class="filter-btn" data-filter="serial">Serialized</button>
                            <button class="filter-btn" data-filter="coming-soon">Forthcoming</button>
                        </div>
                    </div>
                    <div id="publicationsContainer" class="publications-grid"></div>
                </div>
            `;
            main.appendChild(librarySection);
            renderPublicationsGrid(allWorks);

            // Filter listeners
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.addEventListener('click', function(e) {
                    document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    filterPublications(this.dataset.filter);
                });
            });
        }

        function renderPublicationsGrid(works) {
            const container = document.getElementById('publicationsContainer');
            if (!container) return;
            container.innerHTML = '';

            works.forEach(work => {
                // Determine badge (author-centric, no premium/free)
                let badgeClass = 'badge-article';
                let badgeText = work.type || 'work';
                if (work.status === 'coming-soon') {
                    badgeClass = 'badge-coming-soon';
                    badgeText = 'Forthcoming';
                } else if (work.type === 'book' || work.type === 'book (legacy)') {
                    badgeClass = 'badge-book';
                    badgeText = 'Book';
                } else if (work.type === 'serial' || work.status === 'serialized') {
                    badgeClass = 'badge-serial';
                    badgeText = 'Serial';
                } else if (work.type === 'essay') {
                    badgeClass = 'badge-essay';
                    badgeText = 'Essay';
                }

                // Button: if coming soon → waitlist, else → read (reader.html placeholder)
                let buttonHtml = '';
                if (work.status === 'coming-soon') {
                    buttonHtml = `<button class="btn-read btn-waitlist" onclick="openWaitlistModal('${work.id}', '${work.title?.replace(/'/g, "\\'") || 'Untitled'}')"><i class="fas fa-bell"></i> Notify me</button>`;
                } else {
                    buttonHtml = `<button class="btn-read" onclick="window.open('reader.html?id=${work.id}', '_blank')"><i class="fas fa-book-open"></i> Read</button>`;
                }

                // reading time
                const readingTime = work.metadata?.readingTime || 
                    (work.metadata?.wordCount ? `${Math.ceil(work.metadata.wordCount/200)} min` : '—');
                const chapterCount = work.metadata?.chapterCount || (work.content?.chapters?.length) || '—';

                const card = document.createElement('div');
                card.className = 'publication-card';
                card.dataset.type = work.type || 'book';
                card.dataset.status = work.status || 'published';
                
                card.innerHTML = `
                    <span class="publication-badge ${badgeClass}">${badgeText}</span>
                    <span class="publication-type"><i class="fas fa-${work.type === 'article' ? 'newspaper' : 'book'}"></i> ${work.type || 'work'}</span>
                    <h3 class="publication-title">${work.title || 'Untitled'}</h3>
                    ${work.subtitle ? `<div class="publication-subtitle">${work.subtitle}</div>` : ''}
                    <div class="publication-meta">
                        ${chapterCount !== '—' ? `<span><i class="fas fa-file-alt"></i> ${chapterCount} chapters</span>` : ''}
                        ${readingTime !== '—' ? `<span><i class="fas fa-clock"></i> ${readingTime}</span>` : ''}
                        ${work.stats?.reads ? `<span><i class="fas fa-eye"></i> ${work.stats.reads} reads</span>` : ''}
                    </div>
                    <p class="publication-description">${work.description || work.subtitle || 'A work by Mugera W.'}</p>
                    <div class="publication-footer">
                        <span class="reading-time"><i class="fas fa-hourglass-half"></i> ${readingTime}</span>
                        ${buttonHtml}
                    </div>
                `;
                container.appendChild(card);
            });
        }

        function filterPublications(filter) {
            let allWorks = [...publicationsWorks];
            authorBooks.forEach(b => { if (!allWorks.find(w => w.title === b.title)) allWorks.push({...b, type:'book'}); });
            let filtered = allWorks;
            if (filter === 'book') filtered = allWorks.filter(w => w.type === 'book' || w.type === 'book (legacy)');
            else if (filter === 'article') filtered = allWorks.filter(w => w.type === 'article');
            else if (filter === 'essay') filtered = allWorks.filter(w => w.type === 'essay');
            else if (filter === 'serial') filtered = allWorks.filter(w => w.type === 'serial' || w.status === 'serialized');
            else if (filter === 'coming-soon') filtered = allWorks.filter(w => w.status === 'coming-soon');
            renderPublicationsGrid(filtered);
        }

        // ----- SERIES SECTION (no pricing/bundles) -----
        function renderSeriesCollections() {
            if (!seriesArray.length) return;
            const main = document.getElementById('mainContent');
            const section = document.createElement('section');
            section.className = 'series-section';
            section.id = 'series';
            let seriesHtml = '';
            seriesArray.forEach(s => {
                seriesHtml += `
                    <div class="series-card">
                        <h3 class="series-name">${s.name}</h3>
                        <p style="color: rgba(255,255,255,0.8); margin-bottom: 1rem;">${s.description || ''}</p>
                        <span class="series-work-count">${s.works?.length || 0} works</span>
                    </div>
                `;
            });
            section.innerHTML = `
                <div style="max-width: 1200px; margin: 0 auto;">
                    <h2 class="cinzel" style="color: white; font-size: 2rem;">Series & collections</h2>
                    <p style="color: rgba(255,255,255,0.7); margin-top: 0.5rem;">Curated reading journeys</p>
                    <div class="series-grid">${seriesHtml || '<p style="color:white;">No series yet.</p>'}</div>
                </div>
            `;
            main.appendChild(section);
        }

        // ----- AUTHOR FOOTER – ONLY BIO, CONTACT, SOCIAL (NO SUBSCRIPTION)-----
        function renderAuthorFooter() {
            const footer = document.getElementById('mainFooter');
            const f = authorBio || {};
            footer.innerHTML = `
                <div class="footer-container">
                    <div class="footer-column">
                        <h3 style="color: white; margin-bottom: 1.2rem;">Mugera W.</h3>
                        <p style="color: rgba(255,255,255,0.7);">Writing at the intersection of legacy, leadership and the human spirit.</p>
                    </div>
                    <div class="footer-column">
                        <h3 style="color: white; margin-bottom: 1.2rem;">Explore</h3>
                        <a href="#library">All works</a>
                        <a href="#series">Series</a>
                        <a href="#">Essays</a>
                    </div>
                    <div class="footer-column">
                        <h3 style="color: white; margin-bottom: 1.2rem;">Connect</h3>
                        <p style="color: rgba(255,255,255,0.7);">${f.contactInfo?.email || 'contact@iammugera.com'}<br>${f.contactInfo?.location || 'Nairobi · Global'}</p>
                    </div>
                </div>
                <div class="copyright">
                    © ${new Date().getFullYear()} I AM MUGERA. Author library. All rights reserved.
                </div>
            `;
        }

        // Fallback if firebase fails – pure sample author library
        function renderFallbackLibrary() {
            publicationsWorks = [
                { id: '1', title: 'The Script of Legacy', type: 'book', status: 'published', description: 'On writing your family and leadership narrative.', metadata: { readingTime: '18 min', chapterCount: 12 } },
                { id: '2', title: 'Why Humans Forget They Are Blessed', type: 'essay', status: 'published', description: 'A philosophical meditation.', metadata: { readingTime: '7 min' } },
                { id: '3', title: 'The Unbound Leader', type: 'book', status: 'coming-soon', description: 'Forthcoming. A new lens on transformational leadership.' },
            ];
            authorBooks = [];
            seriesArray = [{ id: 's1', name: 'Legacy scripts', description: 'Essays on purposeful living', works: [1,2] }];
            renderAuthorHero();
            renderLibrary();
            renderSeriesCollections();
            renderAuthorFooter();
            document.getElementById('loadingOverlay').style.display = 'none';
        }

        // ----- WAITLIST MODAL (simple notification, no payment)-----
        window.openWaitlistModal = function(pubId, pubTitle) {
            document.getElementById('waitlistPublicationId').value = pubId || '';
            document.getElementById('waitlistPublicationTitle').value = pubTitle || '';
            document.getElementById('waitlistModalSubtitle').innerText = pubTitle ? `Be notified when "${pubTitle}" is available.` : 'Join the notification list.';
            document.getElementById('waitlistForm').style.display = 'block';
            document.getElementById('waitlistSuccess').style.display = 'none';
            document.getElementById('waitlistModal').classList.add('active');
        };

        document.getElementById('waitlistForm')?.addEventListener('submit', async function(e) {
            e.preventDefault();
            const btn = e.target.querySelector('button');
            btn.disabled = true; btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Submitting...';
            const data = {
                pubId: document.getElementById('waitlistPublicationId').value,
                name: document.getElementById('waitlistName').value,
                email: document.getElementById('waitlistEmail').value,
                interest: document.getElementById('waitlistInterest').value,
                timestamp: new Date().toISOString()
            };
            try {
                await database.ref('author_waitlists/' + Date.now()).set(data);
                document.getElementById('waitlistForm').style.display = 'none';
                document.getElementById('waitlistSuccess').style.display = 'block';
                setTimeout(() => closeModal('waitlistModal'), 2000);
            } catch (err) { alert('Please try again.'); }
            btn.disabled = false; btn.innerHTML = '<i class="fas fa-bell"></i> Notify me';
        });

        window.closeModal = function(id) { document.getElementById(id).classList.remove('active'); };

        // ---------- INIT ----------
        document.addEventListener('DOMContentLoaded', startTypingAnimation);
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('modal-overlay')) closeModal('waitlistModal');
        });
    </script>
</body>
</html>
