<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=1.0, user-scalable=no">
    <!-- Primary Meta Tags -->
    <title>I AM MUGERA | Official Community</title>
    <meta name="title" content="I AM MUGERA | Official Community">
    <meta name="description" content="Join the official I AM MUGERA community. Connect, share, and engage with like-minded individuals in real-time.">
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#ca8a04" id="themeColor">
    <meta name="background-color" content="#0a0a0a" id="bgColorMeta">
    <meta name="color-scheme" content="dark light">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="I AM MUGERA">
    <meta name="application-name" content="I AM MUGERA">
    
    <!-- Version -->
    <meta name="version" content="4.0.0">
    
    <title>I AM MUGERA | Community</title>
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/Kzsb3tX6/I-AM-MUGERA.png">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/Kzsb3tX6/I-AM-MUGERA.png">
    
    <!-- PWA manifest -->
    <link rel="manifest" href="/manifest.json">
    
    <!-- Fonts & Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Playfair+Display:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-analytics-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        :root {
            --gold: #ca8a04;
            --gold-dark: #b37700;
            --gold-light: #e5b80b;
            --gold-soft: rgba(202, 138, 4, 0.1);
            --gold-gradient: linear-gradient(135deg, #ca8a04, #e5b80b, #ca8a04);
            
            --dark-bg: #0a0a0a;
            --dark-surface: #121212;
            --dark-card: #1a1a1a;
            --dark-border: #2a2a2a;
            --dark-text: #ffffff;
            --dark-text-secondary: #b0b0b0;
            
            --light-bg: #f8f9fa;
            --light-surface: #ffffff;
            --light-card: #f0f0f0;
            --light-border: #e0e0e0;
            --light-text: #1a1a1a;
            --light-text-secondary: #6c757d;
            
            --font-primary: 'Inter', -apple-system, sans-serif;
            --font-display: 'Playfair Display', Georgia, serif;
            
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.1);
            --shadow-md: 0 8px 24px rgba(0,0,0,0.15);
            --shadow-lg: 0 16px 32px rgba(0,0,0,0.2);
            --shadow-gold: 0 4px 20px rgba(202,138,4,0.3);
            
            --radius-sm: 8px;
            --radius-md: 16px;
            --radius-lg: 24px;
            --radius-xl: 32px;
            --radius-full: 9999px;
        }

        body.dark-theme {
            --bg-primary: var(--dark-bg);
            --bg-surface: var(--dark-surface);
            --bg-card: var(--dark-card);
            --text-primary: var(--dark-text);
            --text-secondary: var(--dark-text-secondary);
            --border-color: var(--dark-border);
            --hover-bg: rgba(255,255,255,0.05);
        }

        body.light-theme {
            --bg-primary: var(--light-bg);
            --bg-surface: var(--light-surface);
            --bg-card: var(--light-card);
            --text-primary: var(--light-text);
            --text-secondary: var(--light-text-secondary);
            --border-color: var(--light-border);
            --hover-bg: rgba(0,0,0,0.03);
        }

        body {
            font-family: var(--font-primary);
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            font-size: 16px;
            transition: background-color 0.2s ease;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--dark-bg);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            transition: opacity 0.5s ease;
        }
        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }
        .loading-image {
            width: min(90%, 400px);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-gold);
            margin-bottom: 2rem;
            border: 2px solid var(--gold);
        }
        .loading-text {
            font-family: var(--font-display);
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 700;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            background-size: 200% auto;
            animation: shine 2s linear infinite;
        }
        @keyframes shine { to { background-position: 200% center; } }

        /* Header */
        .site-header {
            position: fixed;
            top: 0;
            width: 100%;
            background: rgba(var(--bg-surface-rgb), 0.85);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border-color);
            z-index: 100;
            padding: 0.75rem 2rem;
        }
        body.dark-theme { --bg-surface-rgb: 18, 18, 18; }
        body.light-theme { --bg-surface-rgb: 255, 255, 255; }
        
        .header-container {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .logo {
            height: 42px;
            width: auto;
            border-radius: var(--radius-sm);
        }
        .header-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .user-profile {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-full);
            background: var(--hover-bg);
        }
        .user-avatar {
            width: 38px;
            height: 38px;
            border-radius: var(--radius-full);
            border: 2px solid var(--gold);
            object-fit: cover;
        }
        .user-name {
            font-weight: 500;
            font-size: 0.95rem;
        }
        .sign-in-btn {
            background: var(--gold);
            color: black;
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: var(--radius-full);
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        .sign-in-btn:hover {
            background: var(--gold-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-gold);
        }
        .theme-toggle {
            width: 42px;
            height: 42px;
            border: 1.5px solid var(--gold);
            border-radius: var(--radius-full);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: var(--gold);
            background: transparent;
            transition: all 0.2s;
        }
        .theme-toggle:hover {
            background: var(--gold);
            color: black;
            transform: rotate(15deg);
        }

        /* Hero Section */
        .hero {
            min-height: 85vh;
            background: linear-gradient(135deg, rgba(0,0,0,0.95), rgba(20,20,20,0.9));
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 7rem 2rem 4rem;
            position: relative;
            overflow: hidden;
        }
        body.light-theme .hero {
            background: linear-gradient(135deg, rgba(255,255,255,0.98), rgba(245,245,245,0.95));
        }
        .hero-background {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://i.postimg.cc/xdX6vP2M/20260204-1035-Image-Generation-remix-01kgks60qgeata5pv0jy8vkg0d.webp');
            background-size: cover;
            background-position: center;
            opacity: 0.1;
            pointer-events: none;
        }
        .hero-content {
            max-width: 1000px;
            text-align: center;
            position: relative;
            z-index: 2;
        }
        .hero-title {
            font-family: var(--font-display);
            font-size: clamp(3rem, 8vw, 5rem);
            font-weight: 700;
            background: var(--gold-gradient);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            margin-bottom: 0.5rem;
        }
        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--text-secondary);
            margin-bottom: 3rem;
        }
        .stats-grid {
            display: flex;
            justify-content: center;
            gap: 3rem;
            margin: 3rem 0;
        }
        .stat-card {
            text-align: center;
            padding: 1.5rem 2rem;
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            min-width: 150px;
        }
        .stat-value {
            font-size: 2.5rem;
            font-weight: 700;
            color: var(--gold);
            line-height: 1;
        }
        .stat-label {
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Navigation Cards */
        .nav-grid {
            max-width: 1200px;
            margin: -2rem auto 4rem;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 2rem;
            position: relative;
            z-index: 10;
        }
        .nav-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-xl);
            padding: 2.5rem 2rem;
            text-align: center;
            transition: all 0.3s;
            cursor: pointer;
            backdrop-filter: blur(8px);
        }
        .nav-card:hover {
            transform: translateY(-8px);
            border-color: var(--gold);
            box-shadow: var(--shadow-gold);
        }
        .nav-icon {
            font-size: 2.5rem;
            color: var(--gold);
            margin-bottom: 1.5rem;
        }
        .nav-card h3 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }

        /* Community Page */
        .community-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--bg-primary);
            z-index: 1000;
            overflow-y: auto;
            display: none;
        }
        .community-page.active {
            display: block;
        }
        .community-header {
            background: var(--bg-surface);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(12px);
        }
        .community-header-content {
            max-width: 1400px;
            margin: 0 auto;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .community-title {
            font-family: var(--font-display);
            font-size: 1.5rem;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .close-community {
            background: transparent;
            border: 1.5px solid var(--gold);
            color: var(--gold);
            width: 42px;
            height: 42px;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all 0.2s;
        }
        .close-community:hover {
            background: var(--gold);
            color: black;
            transform: rotate(90deg);
        }

        /* Community Layout */
        .community-container {
            max-width: 1400px;
            margin: 2rem auto;
            padding: 0 2rem;
            display: grid;
            grid-template-columns: 1fr 320px;
            gap: 2rem;
        }

        /* Feed */
        .feed {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .post-creator {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
        }
        .creator-avatar {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .creator-avatar img {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-full);
            border: 2px solid var(--gold);
            object-fit: cover;
        }
        .creator-input {
            width: 100%;
            padding: 1rem;
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            color: var(--text-primary);
            font-family: inherit;
            resize: none;
            margin-bottom: 1rem;
        }
        .creator-input:focus {
            outline: none;
            border-color: var(--gold);
        }
        .post-btn {
            background: var(--gold);
            color: black;
            border: none;
            padding: 0.75rem 2rem;
            border-radius: var(--radius-full);
            font-weight: 600;
            cursor: pointer;
            float: right;
            transition: all 0.2s;
        }
        .post-btn:hover:not(:disabled) {
            background: var(--gold-dark);
            transform: scale(1.02);
        }
        .post-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Post Card */
        .post-card {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            transition: all 0.2s;
        }
        .post-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        .post-author {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .post-author img {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            border: 2px solid var(--gold);
            object-fit: cover;
        }
        .author-info h4 {
            font-weight: 600;
        }
        .post-time {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        .post-content {
            margin-bottom: 1rem;
            white-space: pre-wrap;
        }
        .post-actions {
            display: flex;
            gap: 1.5rem;
            padding: 0.75rem 0;
            border-top: 1px solid var(--border-color);
        }
        .action-btn {
            background: transparent;
            border: none;
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            transition: all 0.2s;
            padding: 0.25rem 1rem;
            border-radius: var(--radius-full);
        }
        .action-btn:hover {
            color: var(--gold);
            background: var(--gold-soft);
        }
        .action-btn.active {
            color: var(--gold);
        }
        .action-btn.active i {
            font-weight: 900;
        }

        /* Comments */
        .comments-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
        }
        .comment {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }
        .comment img {
            width: 32px;
            height: 32px;
            border-radius: var(--radius-full);
            border: 1px solid var(--gold);
            object-fit: cover;
        }
        .comment-content {
            flex: 1;
            background: var(--bg-surface);
            padding: 0.75rem;
            border-radius: var(--radius-lg);
        }
        .comment-author {
            font-weight: 600;
            font-size: 0.9rem;
        }
        .comment-text {
            font-size: 0.9rem;
        }
        .comment-time {
            font-size: 0.7rem;
            color: var(--text-secondary);
        }
        .comment-input-area {
            display: flex;
            gap: 0.75rem;
            margin-top: 1rem;
        }
        .comment-input {
            flex: 1;
            padding: 0.75rem;
            background: var(--bg-surface);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-full);
            color: var(--text-primary);
        }
        .comment-input:focus {
            outline: none;
            border-color: var(--gold);
        }
        .comment-submit {
            background: var(--gold);
            color: black;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            cursor: pointer;
            transition: all 0.2s;
        }
        .comment-submit:hover:not(:disabled) {
            background: var(--gold-dark);
            transform: scale(1.05);
        }
        .comment-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* Sidebar */
        .community-sidebar {
            background: var(--bg-card);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            height: fit-content;
            position: sticky;
            top: 90px;
        }
        .sidebar-title {
            font-weight: 600;
            margin-bottom: 1.5rem;
            color: var(--gold);
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .members-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-bottom: 2rem;
        }
        .member-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.5rem;
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }
        .member-item:hover {
            background: var(--hover-bg);
        }
        .member-item img {
            width: 40px;
            height: 40px;
            border-radius: var(--radius-full);
            border: 2px solid var(--gold);
            object-fit: cover;
        }
        .member-info {
            flex: 1;
        }
        .member-name {
            font-weight: 500;
            font-size: 0.95rem;
        }
        .member-status {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        .online-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #4caf50;
            border-radius: var(--radius-full);
            margin-right: 0.5rem;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.5; } 100% { opacity: 1; } }

        /* Footer */
        .footer {
            background: var(--bg-surface);
            border-top: 1px solid var(--border-color);
            padding: 3rem 2rem;
            text-align: center;
        }

        /* Install Button */
        .install-pwa {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--gold);
            color: black;
            border: none;
            border-radius: var(--radius-full);
            padding: 0.75rem 1.5rem;
            font-weight: 600;
            cursor: pointer;
            box-shadow: var(--shadow-gold);
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 0.5rem;
        }
        .install-pwa.show { display: flex; }

        @media (max-width: 900px) {
            .community-container {
                grid-template-columns: 1fr;
            }
            .stats-grid {
                flex-direction: column;
                gap: 1rem;
                align-items: center;
            }
        }
    </style>
</head>
<body class="dark-theme">

<!-- Loading Overlay -->
<div class="loading-overlay" id="loadingOverlay">
    <img src="https://i.postimg.cc/xCvsws8M/20260220-1245-Image-Generation-simple-compose-01khx700xgea3rpkfzhfvyzv5d-1-1.webp" 
         alt="I AM MUGERA" class="loading-image">
    <div class="loading-text" id="animatedText">I AM MUGERA</div>
</div>

<!-- Main Content -->
<main id="mainContent">

    <!-- Header -->
    <header class="site-header">
        <div class="header-container">
            <img src="https://i.postimg.cc/HLQqRybx/mm.jpg" alt="I AM MUGERA" class="logo">
            
            <div class="header-actions">
                <div id="userProfile" style="display: none;" class="user-profile">
                    <img id="userAvatar" src="" alt="" class="user-avatar">
                    <span id="userDisplayName" class="user-name"></span>
                </div>
                <button id="signInBtn" class="sign-in-btn" onclick="signInWithGoogle()">
                    <i class="fab fa-google"></i> Sign In
                </button>
                <button id="signOutBtn" class="sign-in-btn" style="display: none;" onclick="signOut()">
                    <i class="fas fa-sign-out-alt"></i> Sign Out
                </button>
                <div class="theme-toggle" id="themeToggle">
                    <i class="fas fa-moon" id="themeIcon"></i>
                </div>
            </div>
        </div>
    </header>

    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-background"></div>
        <div class="hero-content">
            <h1 class="hero-title">I AM MUGERA</h1>
            <p class="hero-subtitle">Dream · Aspire · Inspire — Join our growing community</p>
            
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card">
                    <div class="stat-value" id="memberCount">0</div>
                    <div class="stat-label">Members</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="postCount">0</div>
                    <div class="stat-label">Posts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="onlineCount">0</div>
                    <div class="stat-label">Online</div>
                </div>
            </div>
        </div>
    </section>

    <!-- Navigation Cards -->
    <div class="nav-grid">
        <div class="nav-card" onclick="window.location='mugera.html'">
            <div class="nav-icon"><i class="fas fa-user-tie"></i></div>
            <h3>I Am Mugera</h3>
            <p class="text-secondary">Speaker · Coach · Author</p>
        </div>
        <div class="nav-card" onclick="openCommunity()">
            <div class="nav-icon"><i class="fas fa-users"></i></div>
            <h3>Community</h3>
            <p class="text-secondary">Connect & engage in real-time</p>
        </div>
        <div class="nav-card" onclick="window.location='Afrika.html'">
            <div class="nav-icon"><i class="fas fa-flag-africa"></i></div>
            <h3>Campaigns</h3>
            <p class="text-secondary">Join the movement</p>
        </div>
        <div class="nav-card" onclick="window.location='shop.html'">
            <div class="nav-icon"><i class="fas fa-shopping-bag"></i></div>
            <h3>Shop</h3>
            <p class="text-secondary">Books & merchandise</p>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p class="text-secondary">© 2026 I AM MUGERA — Afrika Milele. All rights reserved.</p>
    </footer>
</main>

<!-- Community Page -->
<div class="community-page" id="communityPage">
    <div class="community-header">
        <div class="community-header-content">
            <div class="community-title">
                <i class="fas fa-users"></i> Community Space
                <span id="onlineIndicator" style="font-size: 0.9rem; color: #4caf50; margin-left: 1rem;">
                    <i class="fas fa-circle"></i> <span id="onlineCountHeader">0</span> online
                </span>
            </div>
            <button class="close-community" onclick="closeCommunity()">
                <i class="fas fa-times"></i>
            </button>
        </div>
    </div>

    <div class="community-container">
        <!-- Feed -->
        <div class="feed">
            <!-- Post Creator (only shown when signed in) -->
            <div id="postCreator" class="post-creator" style="display: none;">
                <div class="creator-avatar">
                    <img id="creatorAvatar" src="" alt="">
                    <span id="creatorName"></span>
                </div>
                <textarea class="creator-input" id="postContent" placeholder="Share your thoughts..." rows="3"></textarea>
                <button class="post-btn" onclick="createPost()" id="postBtn">Post</button>
            </div>

            <!-- Posts Container -->
            <div id="postsContainer"></div>
        </div>

        <!-- Sidebar -->
        <div class="community-sidebar">
            <h4 class="sidebar-title"><i class="fas fa-users"></i> Active Members</h4>
            <div class="members-list" id="activeMembers"></div>
            
            <h4 class="sidebar-title" style="margin-top: 2rem;"><i class="fas fa-info-circle"></i> Guidelines</h4>
            <ul style="color: var(--text-secondary); list-style: none;">
                <li style="margin-bottom: 0.5rem;">✓ Be respectful</li>
                <li style="margin-bottom: 0.5rem;">✓ Stay on topic</li>
                <li style="margin-bottom: 0.5rem;">✓ No spam</li>
                <li style="margin-bottom: 0.5rem;">✓ Embrace unity</li>
            </ul>
        </div>
    </div>
</div>

<!-- Install Button -->
<button class="install-pwa" id="installButton">
    <i class="fas fa-download"></i> Install App
</button>

<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyC7kppUyHUaPzeLBV62NEZWuHiuz1Kz0mA",
        authDomain: "mugera-e51cc.firebaseapp.com",
        databaseURL: "https://mugera-e51cc-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "mugera-e51cc",
        storageBucket: "mugera-e51cc.firebasestorage.app",
        messagingSenderId: "1024868637509",
        appId: "1:1024868637509:web:321faecddce8f11d9cfc2c"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const database = firebase.database();
    const analytics = firebase.analytics();

    // Google Auth Provider
    const googleProvider = new firebase.auth.GoogleAuthProvider();

    // State
    let currentUser = null;
    let currentUserId = null;

    // Loading Animation
    setTimeout(() => {
        document.getElementById('loadingOverlay').classList.add('hidden');
        analytics.logEvent('page_view');
    }, 2000);

    // Theme Toggle
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    const body = document.body;

    const savedTheme = localStorage.getItem('theme') || 'dark';
    if (savedTheme === 'light') {
        body.classList.remove('dark-theme');
        body.classList.add('light-theme');
        themeIcon.classList.replace('fa-moon', 'fa-sun');
    }

    themeToggle.addEventListener('click', () => {
        if (body.classList.contains('dark-theme')) {
            body.classList.replace('dark-theme', 'light-theme');
            themeIcon.classList.replace('fa-moon', 'fa-sun');
            localStorage.setItem('theme', 'light');
        } else {
            body.classList.replace('light-theme', 'dark-theme');
            themeIcon.classList.replace('fa-sun', 'fa-moon');
            localStorage.setItem('theme', 'dark');
        }
    });

    // Auth State Observer
    auth.onAuthStateChanged((user) => {
        if (user) {
            currentUser = user;
            currentUserId = user.uid;
            
            // Update UI
            document.getElementById('signInBtn').style.display = 'none';
            document.getElementById('signOutBtn').style.display = 'flex';
            document.getElementById('userProfile').style.display = 'flex';
            document.getElementById('userAvatar').src = user.photoURL || 'https://via.placeholder.com/40';
            document.getElementById('userDisplayName').textContent = user.displayName || 'User';
            
            // Update creator section
            document.getElementById('postCreator').style.display = 'block';
            document.getElementById('creatorAvatar').src = user.photoURL || 'https://via.placeholder.com/48';
            document.getElementById('creatorName').textContent = user.displayName || 'User';
            
            // Track online status
            const userStatusRef = database.ref(`status/${user.uid}`);
            const userRef = database.ref(`users/${user.uid}`);
            
            userRef.set({
                uid: user.uid,
                name: user.displayName,
                email: user.email,
                photoURL: user.photoURL,
                lastSeen: firebase.database.ServerValue.TIMESTAMP
            });
            
            userStatusRef.set({
                state: 'online',
                lastChanged: firebase.database.ServerValue.TIMESTAMP
            });
            
            userStatusRef.onDisconnect().set({
                state: 'offline',
                lastChanged: firebase.database.ServerValue.TIMESTAMP
            });
            
        } else {
            currentUser = null;
            currentUserId = null;
            
            // Update UI
            document.getElementById('signInBtn').style.display = 'flex';
            document.getElementById('signOutBtn').style.display = 'none';
            document.getElementById('userProfile').style.display = 'none';
            document.getElementById('postCreator').style.display = 'none';
        }
    });

    // Sign In
    window.signInWithGoogle = function() {
        auth.signInWithPopup(googleProvider)
            .catch(error => console.error('Sign in error:', error));
    };

    // Sign Out
    window.signOut = function() {
        if (currentUserId) {
            database.ref(`status/${currentUserId}`).remove();
        }
        auth.signOut();
    };

    // Community Controls
    window.openCommunity = function() {
        document.getElementById('communityPage').classList.add('active');
        document.body.style.overflow = 'hidden';
        loadPosts();
        loadActiveMembers();
        loadStats();
    };

    window.closeCommunity = function() {
        document.getElementById('communityPage').classList.remove('active');
        document.body.style.overflow = '';
    };

    // Load Stats
    function loadStats() {
        // Member count
        database.ref('users').on('value', (snapshot) => {
            document.getElementById('memberCount').textContent = snapshot.numChildren() || 0;
        });
        
        // Post count
        database.ref('posts').on('value', (snapshot) => {
            document.getElementById('postCount').textContent = snapshot.numChildren() || 0;
        });
        
        // Online count
        database.ref('status').on('value', (snapshot) => {
            let online = 0;
            snapshot.forEach((child) => {
                if (child.val().state === 'online') online++;
            });
            document.getElementById('onlineCount').textContent = online;
            document.getElementById('onlineCountHeader').textContent = online;
        });
    }

    // Load Posts
    function loadPosts() {
        const postsRef = database.ref('posts').limitToLast(50);
        
        postsRef.off('child_added');
        postsRef.off('child_changed');
        postsRef.off('child_removed');
        
        postsRef.on('child_added', (snapshot) => {
            const post = snapshot.val();
            post.id = snapshot.key;
            displayPost(post);
        });
        
        postsRef.on('child_changed', (snapshot) => {
            const post = snapshot.val();
            post.id = snapshot.key;
            updatePost(post);
        });
        
        postsRef.on('child_removed', (snapshot) => {
            document.getElementById(`post-${snapshot.key}`)?.remove();
        });
    }

    // Display Post
    function displayPost(post) {
        const container = document.getElementById('postsContainer');
        if (document.getElementById(`post-${post.id}`)) return;
        
        const postElement = document.createElement('div');
        postElement.className = 'post-card';
        postElement.id = `post-${post.id}`;
        
        const timeAgo = new Date(post.timestamp).toLocaleString();
        const isLiked = post.likes && currentUserId && post.likes[currentUserId];
        
        postElement.innerHTML = `
            <div class="post-header">
                <div class="post-author">
                    <img src="${post.photoURL || 'https://via.placeholder.com/40'}" alt="">
                    <div class="author-info">
                        <h4>${post.userName}</h4>
                        <span class="post-time">${timeAgo}</span>
                    </div>
                </div>
            </div>
            <div class="post-content">${post.content}</div>
            <div class="post-actions">
                <button class="action-btn ${isLiked ? 'active' : ''}" onclick="toggleLike('${post.id}')">
                    <i class="fas fa-heart"></i> <span id="likes-${post.id}">${post.likesCount || 0}</span>
                </button>
                <button class="action-btn" onclick="toggleComments('${post.id}')">
                    <i class="fas fa-comment"></i> <span>${post.commentsCount || 0}</span>
                </button>
            </div>
            <div class="comments-section" id="comments-${post.id}" style="display: none;">
                <div id="comments-container-${post.id}"></div>
                ${currentUser ? `
                    <div class="comment-input-area">
                        <input type="text" class="comment-input" id="comment-input-${post.id}" placeholder="Write a comment...">
                        <button class="comment-submit" onclick="addComment('${post.id}')" id="comment-btn-${post.id}">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                ` : ''}
            </div>
        `;
        
        container.prepend(postElement);
        loadComments(post.id);
    }

    // Update Post
    function updatePost(post) {
        const likesSpan = document.getElementById(`likes-${post.id}`);
        if (likesSpan) likesSpan.textContent = post.likesCount || 0;
    }

    // Create Post
    window.createPost = function() {
        if (!currentUser) return;
        
        const content = document.getElementById('postContent').value.trim();
        if (!content) return;
        
        const postBtn = document.getElementById('postBtn');
        postBtn.disabled = true;
        
        const post = {
            userId: currentUser.uid,
            userName: currentUser.displayName,
            photoURL: currentUser.photoURL,
            content: content,
            timestamp: firebase.database.ServerValue.TIMESTAMP,
            likesCount: 0,
            commentsCount: 0
        };
        
        database.ref('posts').push(post)
            .then(() => {
                document.getElementById('postContent').value = '';
                postBtn.disabled = false;
                analytics.logEvent('create_post');
            })
            .catch(error => {
                console.error('Post error:', error);
                postBtn.disabled = false;
            });
    };

    // Toggle Like
    window.toggleLike = function(postId) {
        if (!currentUser) {
            alert('Please sign in to like posts');
            return;
        }
        
        const likeRef = database.ref(`posts/${postId}/likes/${currentUser.uid}`);
        const likesCountRef = database.ref(`posts/${postId}/likesCount`);
        
        likeRef.once('value').then((snapshot) => {
            if (snapshot.exists()) {
                likeRef.remove();
                likesCountRef.transaction(count => Math.max(0, (count || 1) - 1));
            } else {
                likeRef.set(true);
                likesCountRef.transaction(count => (count || 0) + 1);
            }
        });
    };

    // Toggle Comments
    window.toggleComments = function(postId) {
        const commentsDiv = document.getElementById(`comments-${postId}`);
        commentsDiv.style.display = commentsDiv.style.display === 'none' ? 'block' : 'none';
    };

    // Load Comments
    function loadComments(postId) {
        const commentsRef = database.ref(`comments/${postId}`).limitToLast(20);
        
        commentsRef.off('child_added');
        commentsRef.on('child_added', (snapshot) => {
            const comment = snapshot.val();
            comment.id = snapshot.key;
            displayComment(postId, comment);
        });
    }

    // Display Comment
    function displayComment(postId, comment) {
        const container = document.getElementById(`comments-container-${postId}`);
        if (!container) return;
        
        const commentElement = document.createElement('div');
        commentElement.className = 'comment';
        commentElement.id = `comment-${comment.id}`;
        commentElement.innerHTML = `
            <img src="${comment.photoURL || 'https://via.placeholder.com/32'}" alt="">
            <div class="comment-content">
                <div class="comment-author">${comment.userName}</div>
                <div class="comment-text">${comment.content}</div>
                <div class="comment-time">${new Date(comment.timestamp).toLocaleString()}</div>
            </div>
        `;
        container.appendChild(commentElement);
    }

    // Add Comment
    window.addComment = function(postId) {
        if (!currentUser) return;
        
        const input = document.getElementById(`comment-input-${postId}`);
        const btn = document.getElementById(`comment-btn-${postId}`);
        const content = input.value.trim();
        
        if (!content) return;
        
        btn.disabled = true;
        
        const comment = {
            userId: currentUser.uid,
            userName: currentUser.displayName,
            photoURL: currentUser.photoURL,
            content: content,
            timestamp: firebase.database.ServerValue.TIMESTAMP
        };
        
        database.ref(`comments/${postId}`).push(comment)
            .then(() => {
                input.value = '';
                btn.disabled = false;
                database.ref(`posts/${postId}/commentsCount`).transaction(count => (count || 0) + 1);
                analytics.logEvent('add_comment');
            })
            .catch(error => {
                console.error('Comment error:', error);
                btn.disabled = false;
            });
    };

    // Load Active Members
    function loadActiveMembers() {
        const membersRef = database.ref('status');
        
        membersRef.on('value', (snapshot) => {
            const container = document.getElementById('activeMembers');
            container.innerHTML = '';
            
            snapshot.forEach((child) => {
                const status = child.val();
                if (status.state === 'online') {
                    database.ref(`users/${child.key}`).once('value', (userSnapshot) => {
                        const user = userSnapshot.val();
                        if (user) {
                            container.innerHTML += `
                                <div class="member-item">
                                    <img src="${user.photoURL || 'https://via.placeholder.com/40'}" alt="">
                                    <div class="member-info">
                                        <div class="member-name">${user.name}</div>
                                        <div class="member-status"><span class="online-dot"></span>Online</div>
                                    </div>
                                </div>
                            `;
                        }
                    });
                }
            });
        });
    }

    // Load initial stats
    loadStats();

    // PWA Install
    let deferredPrompt;
    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        document.getElementById('installButton').classList.add('show');
    });

    document.getElementById('installButton').addEventListener('click', async () => {
        const btn = document.getElementById('installButton');
        btn.classList.remove('show');
        if (deferredPrompt) {
            deferredPrompt.prompt();
            await deferredPrompt.userChoice;
            deferredPrompt = null;
        }
    });

    // Escape key to close community
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && document.getElementById('communityPage').classList.contains('active')) {
            closeCommunity();
        }
    });
</script>
</body>
</html>
