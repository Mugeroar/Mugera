<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>I AM MUGERA - Author Management</title>
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/Kzsb3tX6/I-AM-MUGERA.png">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    
    <style>
        /* --------------------------------------------- */
        /* PROFESSIONAL DARK THEME - MATCHES EVENTS PAGE */
        /* --------------------------------------------- */
        :root {
            --black: #0a0a0a;
            --white: #ffffff;
            --gray: #f9f9f9;
            --dark-gray: #1a1a1a;
            --light-gray: #e8e8e8;
            --gold: #ca8a04;
            --gold-light: #fef3c7;
            --gold-dark: #a16207;
            --success: #10b981;
            --error: #ef4444;
            --warning: #f59e0b;
            --info: #3b82f6;
            --purple: #8b5cf6;
            --teal: #14b8a6;
            --pink: #ec4899;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.08);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-2xl: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --radius-xl: 20px;
            --radius-2xl: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            font-size: 15px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            color: var(--white);
            line-height: 1.6;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
        }

        .professional-bg {
            background: 
                linear-gradient(135deg, 
                    rgba(10, 10, 10, 0.92) 0%, 
                    rgba(10, 10, 10, 0.88) 100%),
                url('https://i.postimg.cc/Hn3fK4jT/20260206_1227_Image_Generation_remix_01kgs4ccqtf63rvv82pa8tmgzm.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        /* ---------- LOGIN PAGE (AUTH) ---------- */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            position: relative;
        }

        .login-card {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-2xl);
            padding: 3.5rem;
            width: 100%;
            max-width: 480px;
            box-shadow: var(--shadow-2xl);
            border: 1px solid rgba(255, 255, 255, 0.15);
            position: relative;
            z-index: 1;
            transform: translateY(0);
            transition: var(--transition);
            overflow: hidden;
        }

        .login-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--gold), var(--gold-dark));
        }

        .login-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-2xl), 0 25px 50px rgba(0, 0, 0, 0.3);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 2.5rem;
        }

        .login-logo img {
            height: 90px;
            width: auto;
            margin-bottom: 1rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
        }

        .login-logo h1 {
            font-size: 2rem;
            color: var(--white);
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .login-logo p {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        .alert {
            padding: 1.25rem 1.5rem;
            border-radius: var(--radius-md);
            margin-bottom: 1.75rem;
            display: none;
            border-left: 4px solid;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            color: var(--white);
            box-shadow: var(--shadow-sm);
            align-items: center;
            gap: 0.75rem;
        }

        .alert-error {
            border-left-color: var(--error);
            background: linear-gradient(to right, rgba(239, 68, 68, 0.15), rgba(239, 68, 68, 0.05));
        }

        .alert-success {
            border-left-color: var(--success);
            background: linear-gradient(to right, rgba(16, 185, 129, 0.15), rgba(16, 185, 129, 0.05));
        }

        .alert.show {
            display: flex;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-group {
            margin-bottom: 1.75rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            color: var(--white);
            font-weight: 600;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-label i {
            color: var(--gold);
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem 1.25rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            font-family: 'Inter', sans-serif;
            font-size: 1rem;
            transition: var(--transition);
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }

        .form-input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }

        .form-input:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 4px rgba(202, 138, 4, 0.25);
            transform: translateY(-1px);
            background: rgba(255, 255, 255, 0.15);
        }

        .btn {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--white);
            border: none;
            border-radius: var(--radius-md);
            padding: 1rem 2rem;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            transition: var(--transition);
            width: 100%;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn:hover::before {
            left: 100%;
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(202, 138, 4, 0.5);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .btn-outline {
            background: transparent;
            border: 2px solid rgba(202, 138, 4, 0.4);
            color: var(--gold);
        }

        .btn-outline:hover {
            background: var(--gold);
            color: var(--white);
        }

        .btn-sm {
            padding: 0.75rem 1.5rem;
            font-size: 0.9rem;
        }

        /* ---------- ADMIN PANEL (DARK, MATCHES EVENTS) ---------- */
        .admin-container {
            display: none;
            min-height: 100vh;
            background: 
                linear-gradient(135deg, 
                    rgba(10, 10, 10, 0.92) 0%, 
                    rgba(10, 10, 10, 0.88) 100%),
                url('https://i.postimg.cc/Hn3fK4jT/20260206_1227_Image_Generation_remix_01kgs4ccqtf63rvv82pa8tmgzm.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
        }

        /* ---------- SIDEBAR (IDENTICAL TO EVENTS) ---------- */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .sidebar-header {
            padding: 2rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }

        .sidebar-header::after {
            content: '';
            position: absolute;
            bottom: -1px;
            left: 2rem;
            right: 2rem;
            height: 2px;
            background: linear-gradient(90deg, var(--gold), var(--gold-dark));
        }

        .sidebar-logo {
            text-align: center;
            margin-bottom: 1.5rem;
        }

        .sidebar-logo img {
            height: 70px;
            width: auto;
            margin-bottom: 1rem;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: var(--radius-lg);
        }

        .sidebar-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
            margin-bottom: 0.25rem;
            text-align: center;
        }

        .sidebar-subtitle {
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.8);
            text-align: center;
        }

        .nav-menu {
            list-style: none;
            padding: 2rem 0;
        }

        .nav-item {
            margin-bottom: 0.5rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem 2rem;
            color: rgba(255, 255, 255, 0.8);
            text-decoration: none;
            transition: var(--transition);
            position: relative;
            font-weight: 500;
        }

        .nav-link::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            width: 3px;
            height: 100%;
            background: var(--gold);
            transform: scaleY(0);
            transition: var(--transition);
        }

        .nav-link:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
        }

        .nav-link:hover::before {
            transform: scaleY(1);
        }

        .nav-link.active {
            background: linear-gradient(90deg, rgba(202, 138, 4, 0.2), transparent);
            color: var(--gold);
        }

        .nav-link.active::before {
            transform: scaleY(1);
        }

        .nav-icon {
            width: 20px;
            text-align: center;
        }

        .nav-badge {
            margin-left: auto;
            background: var(--gold);
            color: var(--white);
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 10px;
            font-weight: 600;
            min-width: 24px;
            text-align: center;
        }

        /* ---------- MAIN CONTENT ---------- */
        .main-content {
            margin-left: 280px;
            padding: 2rem;
            min-height: 100vh;
        }

        /* ---------- HEADER (EVENTS STYLE) ---------- */
        .header {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl);
            padding: 1.5rem 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold), var(--gold-dark));
        }

        .page-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--white);
            margin: 0;
        }

        .page-subtitle {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
            margin-top: 0.25rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .user-actions {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .back-btn {
            background: transparent;
            border: 2px solid rgba(202, 138, 4, 0.4);
            color: var(--gold);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
            text-decoration: none;
        }

        .back-btn:hover {
            background: var(--gold);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(202, 138, 4, 0.4);
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: bold;
            font-size: 1rem;
            box-shadow: var(--shadow-md);
        }

        .logout-btn {
            background: transparent;
            border: 2px solid rgba(239, 68, 68, 0.4);
            color: var(--error);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-md);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-weight: 600;
            font-size: 0.9rem;
            transition: var(--transition);
        }

        .logout-btn:hover {
            background: var(--error);
            color: var(--white);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(239, 68, 68, 0.4);
        }

        /* ---------- PAGE CONTENT ---------- */
        .page-content {
            display: none;
        }

        /* ---------- DASHBOARD GRID (STAT CARDS) ---------- */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
            cursor: pointer;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-xl);
            border-color: rgba(202, 138, 4, 0.3);
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--gold), var(--gold-dark));
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, rgba(202, 138, 4, 0.2), rgba(161, 98, 7, 0.2));
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 1rem;
            font-size: 1.5rem;
            color: var(--gold);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--white);
            margin-bottom: 0.25rem;
            line-height: 1;
        }

        .stat-label {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .stat-change {
            margin-top: 0.5rem;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            color: rgba(255, 255, 255, 0.9);
        }
        .stat-change.positive { color: var(--success); }
        .stat-change.warning { color: var(--warning); }
        .stat-change.info { color: var(--info); }

        /* ---------- CONTENT SECTIONS ---------- */
        .content-section {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-xl);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
        }

        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--gold), var(--gold-dark));
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            flex-wrap: wrap;
            gap: 1rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
            margin: 0;
        }

        .section-tools {
            display: flex;
            gap: 0.75rem;
            align-items: center;
            flex-wrap: wrap;
        }

        /* ---------- FILTERS ---------- */
        .filters {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(202, 138, 4, 0.1);
            border-radius: var(--radius-lg);
            border: 1px solid rgba(202, 138, 4, 0.2);
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            min-width: 180px;
        }

        .filter-label {
            font-size: 0.8rem;
            font-weight: 600;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-select {
            padding: 0.5rem 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: var(--radius-md);
            background: rgba(255, 255, 255, 0.1);
            color: var(--white);
            font-family: 'Inter', sans-serif;
            font-size: 0.875rem;
            transition: var(--transition);
        }
        .filter-select option { background: #1a1a1a; color: white; }
        .filter-select:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(202, 138, 4, 0.25);
        }

        /* ---------- CARDS GRID (BOOK CARDS) ---------- */
        .cards-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .book-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .book-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-xl);
            border-color: rgba(202, 138, 4, 0.3);
        }

        .book-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .book-card-title {
            font-size: 1.125rem;
            font-weight: 700;
            color: var(--white);
            margin: 0;
        }

        .book-card-meta {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .book-card-meta-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.875rem;
        }

        .book-card-meta-item i {
            color: var(--gold);
            width: 16px;
        }

        .book-card-description {
            color: rgba(255, 255, 255, 0.9);
            font-size: 0.875rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .book-card-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ---------- STATUS BADGES (AUTHOR) ---------- */
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .status-coming-soon {
            background: rgba(245, 158, 11, 0.2);
            color: var(--gold);
            border: 1px solid rgba(245, 158, 11, 0.3);
        }
        .status-planned {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .status-published {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
            border: 1px solid rgba(16, 185, 129, 0.3);
        }
        .status-draft {
            background: rgba(107, 114, 128, 0.2);
            color: rgba(255, 255, 255, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        /* ---------- FEATURED ARTICLE CARD (DARK) ---------- */
        .featured-card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 2rem;
            box-shadow: var(--shadow-lg);
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: var(--transition);
        }
        .featured-card:hover {
            border-color: rgba(202, 138, 4, 0.3);
        }
        .featured-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1.5rem;
        }
        .featured-card-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
        }
        .featured-card-tag {
            padding: 0.25rem 0.75rem;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--white);
            border-radius: var(--radius-sm);
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .featured-card-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }
        .featured-card-image {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: var(--radius-md);
            background: rgba(255,255,255,0.05);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.3);
            font-size: 3rem;
        }
        .featured-card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: var(--radius-md);
        }
        .featured-card-text {
            color: rgba(255,255,255,0.9);
        }
        .featured-card-description {
            font-size: 1rem;
            margin-bottom: 1rem;
            color: var(--white);
        }
        .featured-card-long-description {
            color: rgba(255,255,255,0.8);
            line-height: 1.6;
        }

        /* ---------- BOOK NUMBER STYLES ---------- */
        .book-number {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 0.75rem;
            color: var(--gold-light);
        }
        .book-number.book1 { background: rgba(202,138,4,0.2); color: #fbbf24; }
        .book-number.book2 { background: rgba(59,130,246,0.2); color: #93c5fd; }
        .book-number.book3 { background: rgba(16,185,129,0.2); color: #a7f3d0; }
        .book-number.book4 { background: rgba(139,92,246,0.2); color: #c4b5fd; }

        /* ---------- ACTION BUTTONS ---------- */
        .action-buttons {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        .action-btn {
            padding: 0.375rem 0.75rem;
            border: none;
            border-radius: var(--radius-sm);
            cursor: pointer;
            font-size: 0.8rem;
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            transition: var(--transition);
            font-weight: 500;
        }
        .action-btn:hover { transform: translateY(-1px); }
        .action-btn.view {
            background: rgba(59, 130, 246, 0.2);
            color: var(--info);
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .action-btn.view:hover { background: rgba(59, 130, 246, 0.3); }
        .action-btn.edit {
            background: rgba(202, 138, 4, 0.2);
            color: var(--gold);
            border: 1px solid rgba(202, 138, 4, 0.3);
        }
        .action-btn.edit:hover { background: rgba(202, 138, 4, 0.3); }
        .action-btn.delete {
            background: rgba(239, 68, 68, 0.2);
            color: var(--error);
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
        .action-btn.delete:hover { background: rgba(239, 68, 68, 0.3); }

        /* ---------- IMAGE PREVIEW (MODAL) ---------- */
        .image-upload-container { margin-bottom: 1rem; }
        .image-preview {
            width: 100%;
            height: 200px;
            border: 2px dashed rgba(255,255,255,0.2);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            margin-top: 0.5rem;
            overflow: hidden;
            background: rgba(255,255,255,0.05);
            color: rgba(255,255,255,0.5);
        }
        .image-preview img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        /* ---------- MODAL (DARK) ---------- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            padding: 1rem;
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: var(--radius-2xl);
            padding: 2.5rem;
            width: 100%;
            max-width: 700px;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            box-shadow: var(--shadow-2xl);
            animation: modalSlideIn 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: var(--white);
        }
        @keyframes modalSlideIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--white);
            margin: 0;
        }
        .modal-close {
            background: rgba(255, 255, 255, 0.1);
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            color: var(--white);
            cursor: pointer;
            transition: var(--transition);
        }
        .modal-close:hover { background: rgba(255, 255, 255, 0.2); }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .form-actions {
            display: flex;
            gap: 0.75rem;
            justify-content: flex-end;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        /* ---------- LOADING / NOTIFICATION / EMPTY STATE ---------- */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .loading-content {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(30px);
            border-radius: var(--radius-xl);
            padding: 2rem;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: white;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(202, 138, 4, 0.1);
            border-radius: 50%;
            border-top-color: var(--gold);
            animation: spin 1s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        .notification-container {
            position: fixed;
            top: 1rem;
            right: 1rem;
            z-index: 9999;
            max-width: 350px;
        }
        .notification {
            background: rgba(255, 255, 255, 0.12);
            backdrop-filter: blur(20px);
            border-radius: var(--radius-lg);
            padding: 1rem 1.25rem;
            margin-bottom: 0.75rem;
            box-shadow: var(--shadow-xl);
            display: flex;
            align-items: center;
            gap: 0.75rem;
            animation: slideInRight 0.3s ease;
            border-left: 4px solid;
            color: var(--white);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        @keyframes slideInRight {
            from { opacity: 0; transform: translateX(100%); }
            to { opacity: 1; transform: translateX(0); }
        }
        .notification.success { border-left-color: var(--success); background: linear-gradient(to right, rgba(16,185,129,0.15), rgba(16,185,129,0.05)); }
        .notification.error { border-left-color: var(--error); background: linear-gradient(to right, rgba(239,68,68,0.15), rgba(239,68,68,0.05)); }
        .notification.warning { border-left-color: var(--warning); background: linear-gradient(to right, rgba(245,158,11,0.15), rgba(245,158,11,0.05)); }
        .notification.info { border-left-color: var(--info); background: linear-gradient(to right, rgba(59,130,246,0.15), rgba(59,130,246,0.05)); }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: rgba(255, 255, 255, 0.7);
        }
        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
            color: var(--gold);
        }
        .empty-state-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--white);
        }
        .empty-state-text { margin-bottom: 1.5rem; max-width: 400px; margin-left: auto; margin-right: auto; }

        /* ---------- RESPONSIVE ---------- */
        @media (max-width: 992px) {
            .sidebar { transform: translateX(-100%); transition: transform 0.3s ease; }
            .sidebar.active { transform: translateX(0); }
            .main-content { margin-left: 0; padding: 1.5rem; }
        }
        @media (max-width: 768px) {
            .header { flex-direction: column; gap: 1rem; text-align: center; }
            .user-actions { width: 100%; justify-content: center; }
            .section-header { flex-direction: column; align-items: stretch; }
            .section-tools { justify-content: center; }
            .filters { flex-direction: column; align-items: stretch; }
            .filter-group { min-width: 100%; }
            .cards-grid { grid-template-columns: 1fr; }
            .dashboard-grid { grid-template-columns: 1fr; }
            .featured-card-content { grid-template-columns: 1fr; }
        }
    </style>
</head>
<body class="professional-bg">
    <!-- LOGIN PAGE (AUTH) - EXACT MATCH EVENTS -->
    <div id="loginPage" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <img src="https://i.postimg.cc/Kzsb3tX6/I-AM-MUGERA.png" alt="I AM MUGERA">
                <h1>Author Management</h1>
                <p>Admin Authentication Required</p>
            </div>
            
            <div id="authError" class="alert alert-error">
                <i class="fas fa-exclamation-circle"></i>
                <span id="errorText">Invalid credentials or session expired</span>
            </div>
            
            <div class="form-group">
                <label class="form-label"><i class="fas fa-envelope"></i> Admin Email</label>
                <input type="email" id="authEmail" class="form-input" placeholder="admin@iammugera.com" required>
            </div>
            <div class="form-group">
                <label class="form-label"><i class="fas fa-lock"></i> Password</label>
                <input type="password" id="authPassword" class="form-input" placeholder="••••••••" required>
            </div>
            
            <button type="button" class="btn" id="authBtn">
                <i class="fas fa-sign-in-alt"></i> Sign In to Author Portal
            </button>
            
            <a href="admin.html" class="btn btn-outline" style="margin-top: 1rem;">
                <i class="fas fa-arrow-left"></i> Back to Master Portal
            </a>
            
            <p style="text-align: center; margin-top: 1.5rem; color: rgba(255, 255, 255, 0.7); font-size: 0.85rem;">
                <i class="fas fa-shield-alt"></i> Secure Admin Access
            </p>
        </div>
    </div>

    <!-- ADMIN PANEL (FULLY RESTYLED TO MATCH EVENTS) -->
    <div id="adminPanel" class="admin-container">
        <!-- SIDEBAR -->
        <nav class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <img src="https://i.postimg.cc/Kzsb3tX6/I-AM-MUGERA.png" alt="I AM MUGERA">
                </div>
                <h2 class="sidebar-title">Author Management</h2>
                <p class="sidebar-subtitle">Complete Book & Article Admin</p>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <i class="fas fa-tachometer-alt nav-icon"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="books">
                        <i class="fas fa-book nav-icon"></i>
                        <span>Books</span>
                        <span class="nav-badge" id="bookCount">0</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="featured">
                        <i class="fas fa-star nav-icon"></i>
                        <span>Featured Article</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-page="analytics">
                        <i class="fas fa-chart-bar nav-icon"></i>
                        <span>Analytics</span>
                    </a>
                </li>
            </ul>
            
            <div style="padding: 1.5rem; border-top: 1px solid rgba(255, 255, 255, 0.1); margin-top: auto;">
                <p style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.6); text-align: center;">
                    <i class="fas fa-lock"></i> Secure Session Active
                </p>
            </div>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="main-content">
            <!-- HEADER (EXACT MATCH EVENTS) -->
            <header class="header">
                <div>
                    <h1 class="page-title" id="pageTitle">Author Dashboard</h1>
                    <div class="page-subtitle">
                        <i class="fas fa-book-open"></i>
                        <span id="pageSubtitle">Complete Book & Article Management System</span>
                    </div>
                </div>
                <div class="user-actions">
                    <a href="master-admin.html" class="back-btn">
                        <i class="fas fa-home"></i> Master Portal
                    </a>
                    <div class="user-avatar" id="userAvatar">A</div>
                    <button class="logout-btn" id="logoutBtn">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
            </header>

            <!-- DASHBOARD PAGE -->
            <div id="dashboardPage" class="page-content">
                <div class="dashboard-grid">
                    <div class="stat-card" onclick="showPage('books')">
                        <div class="stat-icon"><i class="fas fa-book"></i></div>
                        <div class="stat-value" id="totalBooks">0</div>
                        <div class="stat-label">Total Books</div>
                        <div class="stat-change positive"><i class="fas fa-check-circle"></i> Active</div>
                    </div>
                    <div class="stat-card" onclick="showPage('books')">
                        <div class="stat-icon"><i class="fas fa-hourglass-half"></i></div>
                        <div class="stat-value" id="comingSoonBooks">0</div>
                        <div class="stat-label">Coming Soon</div>
                        <div class="stat-change warning"><i class="fas fa-clock"></i> Upcoming</div>
                    </div>
                    <div class="stat-card" onclick="showPage('books')">
                        <div class="stat-icon"><i class="fas fa-tasks"></i></div>
                        <div class="stat-value" id="plannedBooks">0</div>
                        <div class="stat-label">Planned</div>
                        <div class="stat-change info"><i class="fas fa-calendar"></i> Future</div>
                    </div>
                    <div class="stat-card" onclick="showPage('featured')">
                        <div class="stat-icon"><i class="fas fa-star"></i></div>
                        <div class="stat-value" id="featuredStat">1</div>
                        <div class="stat-label">Featured Article</div>
                        <div class="stat-change positive"><i class="fas fa-feather-alt"></i> Active</div>
                    </div>
                </div>

                <!-- RECENT BOOKS SECTION -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Books Collection</h2>
                        <div class="section-tools">
                            <button class="btn btn-sm" onclick="showPage('books')"><i class="fas fa-eye"></i> View All Books</button>
                            <button class="btn btn-outline btn-sm" onclick="addNewBook()"><i class="fas fa-plus"></i> Add New Book</button>
                        </div>
                    </div>
                    <div class="cards-grid" id="recentBooksList"></div>
                </div>

                <!-- FEATURED ARTICLE PREVIEW -->
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Featured Article</h2>
                        <div class="section-tools">
                            <button class="btn btn-sm" onclick="showPage('featured')"><i class="fas fa-eye"></i> View Details</button>
                            <button class="btn btn-outline btn-sm" onclick="editFeaturedArticle()"><i class="fas fa-edit"></i> Edit Article</button>
                        </div>
                    </div>
                    <div id="featuredArticlePreview"></div>
                </div>
            </div>

            <!-- BOOKS PAGE -->
            <div id="booksPage" class="page-content" style="display: none;">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Book Management</h2>
                        <div class="section-tools">
                            <button class="btn btn-sm" onclick="refreshBooks()"><i class="fas fa-sync-alt"></i> Refresh</button>
                            <button class="btn btn-outline btn-sm" onclick="addNewBook()"><i class="fas fa-plus"></i> Add New Book</button>
                        </div>
                    </div>
                    
                    <div class="filters">
                        <div class="filter-group">
                            <label class="filter-label">Status</label>
                            <select id="bookStatusFilter" class="filter-select" onchange="filterBooks()">
                                <option value="all">All Books</option>
                                <option value="coming-soon">Coming Soon</option>
                                <option value="planned">Planned</option>
                                <option value="published">Published</option>
                                <option value="draft">Draft</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Book Number</label>
                            <select id="bookNumberFilter" class="filter-select" onchange="filterBooks()">
                                <option value="all">All Books</option>
                                <option value="book1">Book 1</option>
                                <option value="book2">Book 2</option>
                                <option value="book3">Book 3</option>
                                <option value="book4">Book 4</option>
                            </select>
                        </div>
                        <div class="filter-group">
                            <label class="filter-label">Sort By</label>
                            <select id="bookSortFilter" class="filter-select" onchange="filterBooks()">
                                <option value="number">Book Number</option>
                                <option value="title">Title A-Z</option>
                                <option value="status">Status</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="cards-grid" id="allBooksList"></div>
                </div>
            </div>

            <!-- FEATURED ARTICLE PAGE -->
            <div id="featuredPage" class="page-content" style="display: none;">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Featured Article Management</h2>
                        <div class="section-tools">
                            <button class="btn btn-sm" onclick="refreshFeaturedArticle()"><i class="fas fa-sync-alt"></i> Refresh</button>
                            <button class="btn btn-outline btn-sm" onclick="editFeaturedArticle()"><i class="fas fa-edit"></i> Edit Article</button>
                        </div>
                    </div>
                    <div id="featuredArticleFull"></div>
                </div>
            </div>

            <!-- ANALYTICS PAGE -->
            <div id="analyticsPage" class="page-content" style="display: none;">
                <div class="content-section">
                    <div class="section-header">
                        <h2 class="section-title">Author Analytics</h2>
                        <div class="section-tools">
                            <button class="btn btn-sm" onclick="refreshAnalytics()"><i class="fas fa-sync-alt"></i> Refresh Data</button>
                        </div>
                    </div>
                    <div class="dashboard-grid">
                        <div class="stat-card"><div class="stat-icon"><i class="fas fa-chart-pie"></i></div><div class="stat-value" id="totalBooksAnalytics">0</div><div class="stat-label">Total Books</div></div>
                        <div class="stat-card"><div class="stat-icon"><i class="fas fa-hourglass-end"></i></div><div class="stat-value" id="comingSoonPercentage">0%</div><div class="stat-label">Coming Soon</div></div>
                        <div class="stat-card"><div class="stat-icon"><i class="fas fa-project-diagram"></i></div><div class="stat-value" id="plannedPercentage">0%</div><div class="stat-label">Planned</div></div>
                        <div class="stat-card"><div class="stat-icon"><i class="fas fa-calendar-week"></i></div><div class="stat-value" id="bookWorkflow">0</div><div class="stat-label">In Progress</div></div>
                    </div>
                    <div style="margin-top: 2rem; padding: 1.5rem; background: rgba(255,255,255,0.05); border-radius: var(--radius-lg);">
                        <h3 style="margin-bottom: 1rem; color: var(--white);">Book Status Distribution</h3>
                        <div id="analyticsContent" class="empty-state">
                            <div class="empty-state-icon"><i class="fas fa-chart-bar"></i></div>
                            <h3 class="empty-state-title">Analytics Data</h3>
                            <p class="empty-state-text">Book analytics will appear here once you have more data.</p>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- LOADING / NOTIFICATION / MODALS -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content"><div class="loading-spinner"></div><p style="color: var(--white); font-weight: 600;">Loading Author Management System...</p></div>
    </div>
    <div class="notification-container" id="notificationContainer"></div>

    <!-- BOOK MODAL -->
    <div class="modal-overlay" id="bookModal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="modalTitle">Add New Book</h3><button class="modal-close" onclick="hideModal()">&times;</button></div><div id="modalContent"></div></div></div>
    <!-- FEATURED MODAL -->
    <div class="modal-overlay" id="featuredModal"><div class="modal"><div class="modal-header"><h3 class="modal-title" id="featuredModalTitle">Edit Featured Article</h3><button class="modal-close" onclick="hideFeaturedModal()">&times;</button></div><div id="featuredModalContent"></div></div></div>

    <script>
        // ---------- FIREBASE CONFIG ----------
        const firebaseConfig = {
            apiKey: "AIzaSyC7kppUyHUaPzeLBV62NEZWuHiuz1Kz0mA",
            authDomain: "mugera-e51cc.firebaseapp.com",
            databaseURL: "https://mugera-e51cc-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "mugera-e51cc",
            storageBucket: "mugera-e51cc.firebasestorage.app",
            messagingSenderId: "1024868637509",
            appId: "1:1024868637509:web:321faecddce8f11d9cfc2c"
        };
        let app, auth, database;
        try {
            app = firebase.initializeApp(firebaseConfig);
            auth = firebase.auth();
            database = firebase.database();
        } catch(e) { console.error(e); }

        // ---------- GLOBAL STATE ----------
        let currentUser = null;
        let websiteData = null;
        let allBooks = [];
        let featuredArticle = null;
        let filteredBooks = [];

        // ---------- UTILITIES ----------
        function showLoading(msg="Loading...") { 
            const el = document.getElementById('loadingOverlay');
            el.querySelector('p').textContent = msg; 
            el.classList.add('active'); 
        }
        function hideLoading() { document.getElementById('loadingOverlay').classList.remove('active'); }
        function showNotification(msg, type='info') {
            const container = document.getElementById('notificationContainer');
            const notif = document.createElement('div');
            notif.className = `notification ${type}`;
            const icons = { success:'check-circle', error:'exclamation-circle', warning:'exclamation-triangle', info:'info-circle' };
            notif.innerHTML = `<i class="fas fa-${icons[type]||'info-circle'}"></i><span>${msg}</span>`;
            container.appendChild(notif);
            setTimeout(() => { notif.style.opacity = '0'; notif.style.transform = 'translateX(100%)'; setTimeout(()=>notif.remove(),300); }, 3000);
        }

        // ---------- AUTH (IDENTICAL TO EVENTS) ----------
        async function authenticate() {
            showLoading("Checking authentication...");
            const storedEmail = localStorage.getItem('adminEmail');
            const storedToken = localStorage.getItem('adminToken');
            if (storedEmail && storedToken) { try { if (auth.currentUser) { currentUser = auth.currentUser; await loadInitialData(); showPanel(); hideLoading(); showNotification("Welcome back!","success"); return true; } } catch(e) { console.error(e); } }
            const urlParams = new URLSearchParams(window.location.search);
            const urlToken = urlParams.get('token');
            if (urlToken) {
                try { await auth.signInWithCustomToken(urlToken); currentUser = auth.currentUser; localStorage.setItem('adminToken',urlToken); localStorage.setItem('adminEmail',currentUser.email); await loadInitialData(); showPanel(); hideLoading(); showNotification("Access granted from master portal","success"); window.history.replaceState({},document.title,window.location.pathname); return true; } catch(e) { console.error(e); showNotification("Access token invalid","error"); }
            }
            hideLoading(); document.getElementById('loginPage').style.display = 'flex'; return false;
        }
        async function login(email, password) {
            try { showLoading("Authenticating..."); document.getElementById('authError').style.display='none'; const uc = await auth.signInWithEmailAndPassword(email,password); currentUser = uc.user; const token = await currentUser.getIdToken(); localStorage.setItem('adminToken',token); localStorage.setItem('adminEmail',email); await loadInitialData(); showPanel(); hideLoading(); showNotification("Successfully logged in!","success"); return true; } 
            catch(error) { console.error(error); document.getElementById('authError').style.display='flex'; document.getElementById('errorText').textContent=error.message; hideLoading(); return false; }
        }
        async function logout() {
            try { showLoading("Logging out..."); await auth.signOut(); localStorage.removeItem('adminToken'); localStorage.removeItem('adminEmail'); currentUser = null; document.getElementById('adminPanel').style.display='none'; document.getElementById('loginPage').style.display='flex'; document.getElementById('authEmail').value=''; document.getElementById('authPassword').value=''; document.getElementById('authError').style.display='none'; hideLoading(); showNotification("Successfully logged out","success"); } catch(e) { console.error(e); hideLoading(); showNotification("Logout failed","error"); }
        }
        function showPanel() { document.getElementById('loginPage').style.display='none'; document.getElementById('adminPanel').style.display='block'; updateUserInfo(); showPage('dashboard'); }
        function updateUserInfo() { const email = localStorage.getItem('adminEmail')||currentUser?.email||'admin@iammugera.com'; const name = email.split('@')[0]; document.getElementById('userAvatar').textContent = name.charAt(0).toUpperCase(); }

        // ---------- DATA LOADING ----------
        async function loadInitialData() {
            try { showLoading("Loading author data..."); const snap = await database.ref('iam-mugera').once('value'); websiteData = snap.val(); if(!websiteData) throw new Error("No data"); extractBooksFromData(); extractFeaturedArticleFromData(); updateDashboardStats(); updateAnalyticsStats(); hideLoading(); showNotification("Author data loaded","success"); } 
            catch(e) { console.error(e); hideLoading(); showNotification("Failed to load data: "+e.message,"error"); }
        }
        function extractBooksFromData() {
            allBooks = [];
            if(websiteData?.author?.books) {
                Object.entries(websiteData.author.books).forEach(([id,book])=>{
                    allBooks.push({ id, number: id, title: book.title||'Untitled', description: book.description||'', status: book.status||'draft' });
                });
                allBooks.sort((a,b)=> parseInt(a.number.replace('book','')) - parseInt(b.number.replace('book','')) );
            }
            filteredBooks = [...allBooks];
            document.getElementById('bookCount').textContent = allBooks.length;
        }
        function extractFeaturedArticleFromData() {
            featuredArticle = websiteData?.author?.featuredArticle ? { 
                title: websiteData.author.featuredArticle.title||'', 
                description: websiteData.author.featuredArticle.description||'', 
                longDescription: websiteData.author.featuredArticle.longDescription||'', 
                image: websiteData.author.featuredArticle.image||'', 
                tag: websiteData.author.featuredArticle.tag||'Featured' 
            } : null;
        }

        // ---------- DASHBOARD & RENDERING ----------
        function updateDashboardStats() {
            document.getElementById('totalBooks').textContent = allBooks.length;
            const comingSoon = allBooks.filter(b=>b.status==='coming-soon').length;
            const planned = allBooks.filter(b=>b.status==='planned').length;
            document.getElementById('comingSoonBooks').textContent = comingSoon;
            document.getElementById('plannedBooks').textContent = planned;
            document.getElementById('featuredStat').textContent = featuredArticle?.title ? 1 : 0;
            updateRecentBooksCards();
            updateFeaturedArticlePreview();
        }
        function updateAnalyticsStats() {
            document.getElementById('totalBooksAnalytics').textContent = allBooks.length;
            const comingSoon = allBooks.filter(b=>b.status==='coming-soon').length;
            const planned = allBooks.filter(b=>b.status==='planned').length;
            const total = allBooks.length||1;
            document.getElementById('comingSoonPercentage').textContent = Math.round((comingSoon/total)*100)+'%';
            document.getElementById('plannedPercentage').textContent = Math.round((planned/total)*100)+'%';
            document.getElementById('bookWorkflow').textContent = comingSoon+planned;
        }
        function updateRecentBooksCards() {
            const container = document.getElementById('recentBooksList');
            container.innerHTML = '';
            const recent = allBooks.slice(0,4);
            if(!recent.length) {
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon"><i class="fas fa-book-medical"></i></div><h3 class="empty-state-title">No Books Found</h3><p class="empty-state-text">Start by adding your first book.</p><button class="btn btn-sm" onclick="addNewBook()"><i class="fas fa-plus"></i> Add First Book</button></div>`;
                return;
            }
            recent.forEach(book=>{
                const card = document.createElement('div'); card.className = 'book-card';
                card.innerHTML = `<div class="book-card-header"><h3 class="book-card-title">${book.title}</h3><span class="status-badge status-${book.status||'draft'}">${getStatusLabel(book.status)}</span></div>
                <div class="book-card-meta"><div class="book-card-meta-item"><i class="fas fa-hashtag"></i><span class="book-number ${book.number}">${book.number.toUpperCase()}</span></div></div>
                <p class="book-card-description">${book.description||'No description'}</p>
                <div class="book-card-footer"><button class="action-btn edit" onclick="editBook('${book.id}')"><i class="fas fa-edit"></i> Edit</button><button class="action-btn view" onclick="viewBookDetails('${book.id}')"><i class="fas fa-info-circle"></i> Details</button></div>`;
                container.appendChild(card);
            });
        }
        function updateFeaturedArticlePreview() {
            const container = document.getElementById('featuredArticlePreview');
            if(!featuredArticle?.title) {
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon"><i class="fas fa-newspaper"></i></div><h3 class="empty-state-title">No Featured Article</h3><p class="empty-state-text">Set up your featured article.</p><button class="btn btn-sm" onclick="editFeaturedArticle()"><i class="fas fa-plus"></i> Set Up Article</button></div>`;
                return;
            }
            container.innerHTML = `<div class="featured-card"><div class="featured-card-header"><h3 class="featured-card-title">${featuredArticle.title}</h3><span class="featured-card-tag">${featuredArticle.tag||'Featured'}</span></div>
            <div class="featured-card-content"><div class="featured-card-image">${featuredArticle.image?`<img src="${featuredArticle.image}" alt="Preview" onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-image\\' style=\\'font-size:3rem; color:rgba(255,255,255,0.3);\\'>';">`:'<i class="fas fa-image" style="font-size:3rem; color:rgba(255,255,255,0.3);"></i>'}</div>
            <div class="featured-card-text"><p class="featured-card-description">${featuredArticle.description||''}</p><p class="featured-card-long-description">${featuredArticle.longDescription||''}</p></div></div>
            <div style="text-align:center; margin-top:1.5rem;"><button class="btn btn-sm" onclick="showPage('featured')"><i class="fas fa-eye"></i> View Full Article</button><button class="btn btn-outline btn-sm" onclick="editFeaturedArticle()" style="margin-left:0.5rem;"><i class="fas fa-edit"></i> Edit</button></div></div>`;
        }
        function updateFeaturedArticleFull() {
            const container = document.getElementById('featuredArticleFull');
            if(!featuredArticle?.title) {
                container.innerHTML = `<div class="empty-state"><div class="empty-state-icon"><i class="fas fa-newspaper"></i></div><h3 class="empty-state-title">No Featured Article</h3><p class="empty-state-text">Set up your featured article.</p><button class="btn btn-sm" onclick="editFeaturedArticle()"><i class="fas fa-plus"></i> Set Up Article</button></div>`;
                return;
            }
            container.innerHTML = `<div class="featured-card"><div class="featured-card-header"><h3 class="featured-card-title">${featuredArticle.title}</h3><span class="featured-card-tag">${featuredArticle.tag||'Featured'}</span></div>
            <div class="featured-card-content"><div class="featured-card-image">${featuredArticle.image?`<img src="${featuredArticle.image}" alt="Preview" onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-image\\' style=\\'font-size:3rem; color:rgba(255,255,255,0.3);\\'>';">`:'<i class="fas fa-image" style="font-size:3rem; color:rgba(255,255,255,0.3);"></i>'}</div>
            <div class="featured-card-text"><div style="margin-bottom:1rem;"><h4 style="color:white;">Short Description</h4><p>${featuredArticle.description||''}</p></div><div><h4 style="color:white;">Long Description</h4><p>${featuredArticle.longDescription||''}</p></div></div></div>
            <div style="text-align:center; margin-top:1.5rem;"><button class="btn" onclick="editFeaturedArticle()"><i class="fas fa-edit"></i> Edit Featured Article</button></div></div>`;
        }
        function getStatusLabel(s){ const labels={'coming-soon':'Coming Soon','planned':'Planned','published':'Published','draft':'Draft'}; return labels[s]||s; }

        // ---------- PAGE MANAGEMENT ----------
        function showPage(pageId) {
            document.querySelectorAll('.page-content').forEach(p=>p.style.display='none');
            const page = document.getElementById(pageId+'Page');
            if(page) {
                page.style.display='block';
                const titles={dashboard:'Author Dashboard',books:'Book Management',featured:'Featured Article',analytics:'Author Analytics'};
                const subtitles={dashboard:'Complete Book & Article Management System',books:'Manage all books',featured:'Showcase your featured article',analytics:'Publication insights'};
                document.getElementById('pageTitle').textContent=titles[pageId]||pageId;
                document.getElementById('pageSubtitle').textContent=subtitles[pageId]||'';
                if(pageId==='books') updateBooksList();
                if(pageId==='featured') updateFeaturedArticleFull();
                if(pageId==='dashboard') updateDashboardStats();
                if(pageId==='analytics') updateAnalyticsStats();
            }
            document.querySelectorAll('.nav-link').forEach(l=>l.classList.remove('active'));
            document.querySelector(`.nav-link[data-page="${pageId}"]`)?.classList.add('active');
        }

        // ---------- BOOKS LIST & FILTER ----------
        function updateBooksList() {
            const container = document.getElementById('allBooksList'); container.innerHTML='';
            if(filteredBooks.length===0) {
                container.innerHTML=`<div class="empty-state" style="grid-column:1/-1;"><div class="empty-state-icon"><i class="fas fa-book-open"></i></div><h3 class="empty-state-title">No Books Found</h3><p class="empty-state-text">No books match your filters.</p><button class="btn btn-sm" onclick="clearBookFilters()"><i class="fas fa-filter"></i> Clear Filters</button></div>`;
                return;
            }
            filteredBooks.forEach(book=>{
                const card = document.createElement('div'); card.className='book-card';
                card.innerHTML=`<div class="book-card-header"><h3 class="book-card-title">${book.title}</h3><span class="status-badge status-${book.status||'draft'}">${getStatusLabel(book.status)}</span></div>
                <div class="book-card-meta"><div class="book-card-meta-item"><i class="fas fa-hashtag"></i><span class="book-number ${book.number}">${book.number.toUpperCase()}</span></div></div>
                <p class="book-card-description">${book.description||''}</p>
                <div class="book-card-footer"><button class="action-btn edit" onclick="editBook('${book.id}')"><i class="fas fa-edit"></i> Edit</button><button class="action-btn view" onclick="viewBookDetails('${book.id}')"><i class="fas fa-info-circle"></i> Details</button><button class="action-btn delete" onclick="deleteBook('${book.id}')"><i class="fas fa-trash"></i> Delete</button></div>`;
                container.appendChild(card);
            });
        }
        function filterBooks() {
            const status = document.getElementById('bookStatusFilter').value;
            const numFilter = document.getElementById('bookNumberFilter').value;
            const sort = document.getElementById('bookSortFilter').value;
            filteredBooks = allBooks.filter(b=>(status==='all'||b.status===status) && (numFilter==='all'||b.number===numFilter));
            filteredBooks.sort((a,b)=>{
                if(sort==='title') return a.title.localeCompare(b.title);
                if(sort==='status') return a.status.localeCompare(b.status);
                return parseInt(a.number.replace('book',''))-parseInt(b.number.replace('book',''));
            });
            updateBooksList();
        }
        function clearBookFilters() {
            document.getElementById('bookStatusFilter').value='all';
            document.getElementById('bookNumberFilter').value='all';
            document.getElementById('bookSortFilter').value='number';
            filterBooks();
        }

        // ---------- MODAL CONTROLS ----------
        function hideModal() { document.getElementById('bookModal').classList.remove('active'); }
        function showModal(content,title='Modal') { document.getElementById('modalTitle').textContent=title; document.getElementById('modalContent').innerHTML=content; document.getElementById('bookModal').classList.add('active'); }
        function hideFeaturedModal() { document.getElementById('featuredModal').classList.remove('active'); }
        function showFeaturedModal(content,title='Featured Article') { document.getElementById('featuredModalTitle').textContent=title; document.getElementById('featuredModalContent').innerHTML=content; document.getElementById('featuredModal').classList.add('active'); }

        // ---------- BOOK CRUD ----------
        function addNewBook() {
            const nums = allBooks.map(b=>parseInt(b.number.replace('book',''))).filter(n=>!isNaN(n));
            const next = nums.length?Math.max(...nums)+1:1;
            const nextId = `book${next}`;
            const form = `<form id="bookForm" onsubmit="saveNewBook(event,'${nextId}')"><div class="form-grid"><div class="form-group"><label class="form-label">Book Title *</label><input type="text" class="form-input" name="title" required placeholder="Enter title"></div>
            <div class="form-group"><label class="form-label">Book Number</label><input type="text" class="form-input" name="number" value="${nextId}" readonly style="background: rgba(0,0,0,0.3);"></div>
            <div class="form-group"><label class="form-label">Status *</label><select class="form-input" name="status" required><option value="coming-soon">Coming Soon</option><option value="planned">Planned</option><option value="draft">Draft</option><option value="published">Published</option></select></div>
            <div class="form-group"><label class="form-label">Description *</label><textarea class="form-input" name="description" rows="4" required placeholder="Book description"></textarea></div></div>
            <div class="form-actions"><button type="button" class="btn btn-outline" onclick="hideModal()">Cancel</button><button type="submit" class="btn"><i class="fas fa-save"></i> Save Book</button></div></form>`;
            showModal(form, 'Add New Book');
        }
        async function saveNewBook(e,bookId) {
            e.preventDefault(); showLoading("Saving book...");
            try { const fd = new FormData(e.target); const data = { title: fd.get('title'), description: fd.get('description'), status: fd.get('status')||'draft' }; await database.ref(`iam-mugera/author/books/${bookId}`).set(data); await loadInitialData(); hideModal(); hideLoading(); showNotification("Book created!","success"); showPage('books'); } catch(error) { console.error(error); hideLoading(); showNotification("Failed: "+error.message,"error"); }
        }
        function editBook(bookId) {
            const book = allBooks.find(b=>b.id===bookId); if(!book) { showNotification("Book not found","error"); return; }
            const form = `<form id="bookForm" onsubmit="updateBook(event,'${bookId}')"><div class="form-grid"><div class="form-group"><label class="form-label">Book Title *</label><input type="text" class="form-input" name="title" value="${book.title}" required></div>
            <div class="form-group"><label class="form-label">Book Number</label><input type="text" class="form-input" name="number" value="${book.number}" readonly style="background: rgba(0,0,0,0.3);"></div>
            <div class="form-group"><label class="form-label">Status *</label><select class="form-input" name="status" required>${['coming-soon','planned','draft','published'].map(s=>`<option value="${s}" ${book.status===s?'selected':''}>${getStatusLabel(s)}</option>`).join('')}</select></div>
            <div class="form-group"><label class="form-label">Description *</label><textarea class="form-input" name="description" rows="4" required>${book.description||''}</textarea></div></div>
            <div class="form-actions"><button type="button" class="btn btn-outline" onclick="hideModal()">Cancel</button><button type="submit" class="btn"><i class="fas fa-save"></i> Update Book</button></div></form>`;
            showModal(form, `Edit: ${book.title}`);
        }
        async function updateBook(e,bookId) {
            e.preventDefault(); showLoading("Updating...");
            try { const fd = new FormData(e.target); const data = { title: fd.get('title'), description: fd.get('description'), status: fd.get('status') }; await database.ref(`iam-mugera/author/books/${bookId}`).update(data); await loadInitialData(); hideModal(); hideLoading(); showNotification("Book updated!","success"); } catch(e) { console.error(e); hideLoading(); showNotification("Failed: "+e.message,"error"); }
        }
        async function deleteBook(bookId) {
            if(!confirm("Delete this book? Cannot be undone.")) return; showLoading("Deleting...");
            try { 
                const book = allBooks.find(b=>b.id===bookId);
                if(featuredArticle?.title && book?.title === featuredArticle.title) { hideLoading(); showNotification("Cannot delete book that is currently featured. Update featured article first.","error"); return; }
                await database.ref(`iam-mugera/author/books/${bookId}`).remove(); await loadInitialData(); hideLoading(); showNotification("Book deleted","success"); 
            } catch(e) { console.error(e); hideLoading(); showNotification("Failed: "+e.message,"error"); }
        }
        function viewBookDetails(bookId) {
            const book = allBooks.find(b=>b.id===bookId); if(!book) return;
            const content = `<div style="line-height:1.8;"><h4 style="margin-bottom:1rem; color:white;">${book.title}</h4><div style="background:rgba(255,255,255,0.05); padding:1.5rem; border-radius:var(--radius-lg);">
            <div style="margin-bottom:1rem;"><strong>Book Number:</strong><br><span class="book-number ${book.number}">${book.number.toUpperCase()}</span></div>
            <div style="margin-bottom:1rem;"><strong>Status:</strong><br><span class="status-badge status-${book.status}">${getStatusLabel(book.status)}</span></div>
            <div style="margin-bottom:1rem;"><strong>Description:</strong><br><p>${book.description||''}</p></div>
            <div style="margin-top:1rem; padding-top:1rem; border-top:1px solid rgba(255,255,255,0.1);"><strong>Database Path:</strong><br><code style="color:rgba(255,255,255,0.8);">iam-mugera/author/books/${book.id}</code></div></div></div>
            <div class="form-actions"><button type="button" class="btn" onclick="hideModal()">Close</button></div>`;
            showModal(content, `Book Details: ${book.title}`);
        }

        // ---------- FEATURED ARTICLE CRUD ----------
        function editFeaturedArticle() {
            const form = `<form id="featuredForm" onsubmit="saveFeaturedArticle(event)"><div class="form-grid">
            <div class="form-group"><label class="form-label">Article Title *</label><input type="text" class="form-input" name="title" value="${featuredArticle?.title||''}" required placeholder="Article title"></div>
            <div class="form-group"><label class="form-label">Tag</label><input type="text" class="form-input" name="tag" value="${featuredArticle?.tag||'Coming Soon'}" placeholder="e.g. Featured"></div>
            <div class="form-group"><label class="form-label">Image URL</label><input type="text" class="form-input" name="image" id="featuredImageInput" value="${featuredArticle?.image||''}" placeholder="https://..."></div></div>
            <div class="image-preview" id="featuredImagePreview">${featuredArticle?.image?`<img src="${featuredArticle.image}" alt="Preview" onerror="this.style.display='none'; this.parentElement.innerHTML='<i class=\\'fas fa-image\\' style=\\'font-size:3rem; color:rgba(255,255,255,0.3);\\'>';">`:'<i class="fas fa-image" style="font-size:3rem; color:rgba(255,255,255,0.3);"></i>'}</div>
            <div class="form-group"><label class="form-label">Short Description *</label><textarea class="form-input" name="description" rows="3" required placeholder="Brief description">${featuredArticle?.description||''}</textarea></div>
            <div class="form-group"><label class="form-label">Long Description *</label><textarea class="form-input" name="longDescription" rows="6" required placeholder="Detailed description">${featuredArticle?.longDescription||''}</textarea></div>
            <div class="form-actions"><button type="button" class="btn btn-outline" onclick="hideFeaturedModal()">Cancel</button><button type="submit" class="btn"><i class="fas fa-save"></i> Save Featured Article</button></div></form>
            <script>
                document.getElementById('featuredImageInput')?.addEventListener('input', function(e) {
                    const preview = document.getElementById('featuredImagePreview');
                    if(e.target.value) preview.innerHTML = '<img src="'+e.target.value+'" alt="Preview" onerror="this.style.display=\\'none\\'; preview.innerHTML=\\'<i class=\\\\\\"fas fa-image\\\\\\" style=\\\\\\"font-size:3rem; color:rgba(255,255,255,0.3);\\\\\\">\\\\'>">'; else preview.innerHTML = '<i class="fas fa-image" style="font-size:3rem; color:rgba(255,255,255,0.3);"></i>';
                });
            <\/script>`;
            showFeaturedModal(form, 'Edit Featured Article');
        }
        async function saveFeaturedArticle(e) {
            e.preventDefault(); showLoading("Saving featured article...");
            try { const fd = new FormData(e.target); const data = { title: fd.get('title'), description: fd.get('description'), longDescription: fd.get('longDescription'), image: fd.get('image')||'', tag: fd.get('tag')||'Featured' }; await database.ref('iam-mugera/author/featuredArticle').set(data); await loadInitialData(); hideFeaturedModal(); hideLoading(); showNotification("Featured article updated!","success"); } catch(e) { console.error(e); hideLoading(); showNotification("Failed: "+e.message,"error"); }
        }

        // ---------- UTILITIES ----------
        function refreshBooks() { showLoading("Refreshing books..."); extractBooksFromData(); updateBooksList(); hideLoading(); showNotification("Books refreshed","success"); }
        function refreshFeaturedArticle() { showLoading("Refreshing featured..."); extractFeaturedArticleFromData(); updateFeaturedArticleFull(); hideLoading(); showNotification("Featured article refreshed","success"); }
        function refreshAnalytics() { updateAnalyticsStats(); showNotification("Analytics refreshed","success"); }

        // ---------- EVENT LISTENERS ----------
        function setupEventListeners() {
            document.getElementById('authBtn').addEventListener('click', async ()=>{ const email = document.getElementById('authEmail').value.trim(), pwd = document.getElementById('authPassword').value; if(!email||!pwd) { showNotification("Enter both email and password","error"); return; } await login(email,pwd); });
            document.getElementById('authPassword').addEventListener('keypress', (e)=>{ if(e.key==='Enter') document.getElementById('authBtn').click(); });
            document.getElementById('logoutBtn').addEventListener('click', logout);
            document.querySelectorAll('.nav-link').forEach(link=>{ link.addEventListener('click', (e)=>{ e.preventDefault(); showPage(link.getAttribute('data-page')); }); });
            document.getElementById('bookModal').addEventListener('click', (e)=>{ if(e.target===document.getElementById('bookModal')) hideModal(); });
            document.getElementById('featuredModal').addEventListener('click', (e)=>{ if(e.target===document.getElementById('featuredModal')) hideFeaturedModal(); });
            document.addEventListener('keydown', (e)=>{ if(e.key==='Escape') { hideModal(); hideFeaturedModal(); } });
        }

        // ---------- INIT ----------
        async function init() { setupEventListeners(); await authenticate(); }
        window.addEventListener('DOMContentLoaded', init);

        // GLOBALS
        window.showPage = showPage; window.hideModal = hideModal; window.hideFeaturedModal = hideFeaturedModal; window.addNewBook = addNewBook; window.editBook = editBook; window.deleteBook = deleteBook; window.viewBookDetails = viewBookDetails;
        window.editFeaturedArticle = editFeaturedArticle; window.refreshBooks = refreshBooks; window.refreshFeaturedArticle = refreshFeaturedArticle; window.refreshAnalytics = refreshAnalytics;
        window.filterBooks = filterBooks; window.clearBookFilters = clearBookFilters;
    </script>
</body>
</html>
